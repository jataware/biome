datatype: api
description: "The Cancer Data Aggregator (CDA) is a service of the National Cancer\
  \ Institutes' (NCI) Cancer Research Data Commons. We pull metadata for thousands\
  \ of studies hosted at multiple data repositories across NCI, and make it available\
  \ for search from a single tool so researchers can more easily find and reuse existing\
  \ cancer research data. In between pulling and publishing, we thoroughly clean,\
  \ harmonize, and cross-reference the metadata so you can easily do things like find\
  \ subjects that have participated in multiple studies, discover data from a disease\
  \ that was originally described in different ways at each repository, and compile\
  \ all the data from your favorite program such as CPTAC - no matter where it ended\
  \ up.\n\n# Conceptual Overview\nYou can think of the CDA as a really, really enormous\
  \ spreadsheet full of data. To search this enormous spreadsheet, you'd want to select\
  \ columns that have data you're interested in, and then filter the rows to only\
  \ the values you care about.\n\nCDA data comes from six sources:\n- The Proteomic\
  \ Data Commons (PDC)\n- The Genomic Data Commons (GDC)\n- The Imaging Data Commons\
  \ (IDC)\n- The Cancer Data Service (CDS)\n- The Integrated Canine Data Commons (ICDC)\n\
  - The ISB Cancer Gateway in the Cloud (ISB-CGC)\n\nThe CDA makes this data searchable\
  \ in five main endpoints:\n- subject: A patient entity captures the study-independent\
  \ metadata for research subjects. Human research subjects are usually not traceable\
  \ to a particular person to protect the subjects privacy.\n- researchsubject: A\
  \ research subject is the entity of interest in a specific research study or project,\
  \ typically a human being or an animal, but can also be a device, group of humans\
  \ or animals, or a tissue sample. Human research subjects are usually not traceable\
  \ to a particular person to protect the subjects privacy. This entity plays the\
  \ role of the case_id in existing data. A subject who participates in 3 studies\
  \ will have 3 researchsubject IDs.\n- specimen: Any material taken as a sample from\
  \ a biological entity (living or dead), or from a physical object or the environment.\
  \ Specimens are usually collected as an example of their kind, often for use in\
  \ some investigation.\n- mutation: Molecular data about specific mutations, currently\
  \ limited to the TCGA-READ project from GDC.\n- file: A unit of data about subjects,\
  \ researchsubjects, specimens, or their associated information.\n\nand two endpoints\
  \ that offer deeper information about data in the researchsubject endpoint:\n- diagnosis:\
  \ A collection of characteristics that describe an abnormal condition of the body\
  \ as assessed at a point in time. May be used to capture information about neoplastic\
  \ and non-neoplastic conditions.\n- treatment: Represent medication administration\
  \ or other treatment types.\n\nIf the CDA works like a giant spreadsheet, the endpoints\
  \ are sets of specific columns that always go together. Any metadata field can be\
  \ searched from any endpoint, the only difference between search types is what type\
  \ of data is returned by default.\n\nIf you are looking to build a cohort of distinct\
  \ individuals who meet some criteria, you would search by subject, and the result\
  \ will be a table of information with one row per subject. If you are looking for\
  \ biosamples that can be ordered or a specific format of information (e.g. histological\
  \ slides) start with specimen. This search will return a table of information with\
  \ one row per biosample. If you want to build a cohort, but are particularly interested\
  \ in studies rather than the participants, search by researchsubject.\n\n# Data\
  \ Sources\n## Genomics Data Commons\nThe Genomic Data Commons (GDC) is a cancer\
  \ knowledge network that supports hosting, standardization, and analysis of genomic,\
  \ clinical, and biospecimen data from cancer research programs. The GDC harmonizes\
  \ raw sequencing data, identifies and applies state-of-the-art bioinformatics methods\
  \ for generating mutation calls, structural variants and other high-level data,\
  \ and provides scalable downloads and web-based analysis tools. Because of the personal\
  \ nature of genomic data, some genomic data in the GDC may be controlled access,\
  \ requiring eRA Commons authentication and dbGaP authorization to access the data.\n\
  \n## Proteomic Data Commons\nThe Proteomic Data Commons (PDC) was developed to advance\
  \ understanding of how proteins help to shape the risk, diagnosis, development,\
  \ progression, and treatment of cancer. In-depth analysis of proteomic data allows\
  \ the study of both how and why cancer develops and informs ways of tailoring treatment\
  \ for individual patients using precision medicine. All proteomic data in the PDC\
  \ are open access and, with appropriate attribution, can be included in publications.\n\
  \n## Imaging Data Commons\nNCI Imaging Data Commons (IDC) is a cloud-based repository\
  \ of publicly available cancer imaging data co-located with the analysis and exploration\
  \ tools and resources. IDC is a node within the broader NCI Cancer Research Data\
  \ Commons (CRDC) infrastructure that provides secure access to a large, comprehensive,\
  \ and expanding collection of cancer research data.\n\nAll data hosted by IDC is\
  \ available publicly. The current content of IDC is populated using the radiology\
  \ collections from The Cancer Imaging Archive (TCIA), as well as data collected\
  \ by other major NCI initiatives, such as TCGA, CPTAC, NLST and HTAN. IDC does not\
  \ perform de-identification of images but accepts data de-identified by TCIA or\
  \ other Data Coordinating Centers that are approved by NCI Security.\n\n## Cancer\
  \ Data Services\nThe CDS provides data storage and sharing capabilities for NCI-funded\
  \ studies that fall under the following categories: \u2022 Studies with data that\
  \ do not match an existing CRDC data commons \u2022 Studies with data that do not\
  \ fit current data type criteria and/or the minimum metadata standards for a CRDC\
  \ data commons.\n\nCDS currently hosts a variety of data types from NCI projects\
  \ such as the Human Tumor Atlas Network (HTAN), Division of Cancer Control and Population\
  \ Sciences (DCCPS), and Childhood Cancer Data Initiative (CCDI) as well as data\
  \ from independent research projects. The CDS is home to both open and controlled\
  \ access data.\n\n## Integrated Canine Data Commons\nThe Integrated Canine Data\
  \ Commons (ICDC) is a cloud-based repository of spontaneously-arising canine cancer\
  \ data. ICDC was established to further research on human cancers by enabling comparative\
  \ analysis with canine cancer. The data in the ICDC is sourced from multiple different\
  \ programs and projects; all focused on canine subjects. The data is harmonized\
  \ into an integrated data model and then made available to the research community.\n\
  \n## ISB Cancer Gateway in the Cloud\nThe ISB Cancer Gateway in the Cloud (ISB-CGC)\
  \ is one of three National Cancer Institute (NCI) Cloud Resources tasked with enabling\
  \ researchers to combine cancer data and cloud computation. The ISB-CGC cloud resource\
  \ hosts data from a variety of sources such as HTAN and TCGA, CPTAC, and TARGET\
  \ from the GDC and PDC in Google BigQuery columnar data tables. This includes file,\
  \ case, clinical, and open access derived data that can be accessed both programmatically\
  \ and through interactive web applications, eliminating the need to download and\
  \ store large data sets.\n\n## Data Standards Services (DSS)\nThe DSS provides us\
  \ with harmonized values mapped to the data sources above. In our current release,\
  \ DSS has provided values for: ethnicity, file_format, morphology, primary_diagnosis,\
  \ race, species, therapeutic_agent, source_material_type (cancer/normal), treatment_type,\
  \ and vital_status.\n"
img_url: null
last_updated: null
name: Cancer Data Aggregator
provider: adhoc:biome
resources:
  172e3313-4a85-4c01-9c7e-6712bbd47b4e:
    code: "import cdapython as cda\n\n# Search for subjects with kidney-related cancer\
      \ that have CT imaging data\nct_subjects = cda.get_subject_data(\n    match_all=['primary_site\
      \ = *kidney*', 'file_type = CT*'],\n    add_columns=['file.*']\n)\n\nprint(f\"\
      Found {len(ct_subjects)} subjects with kidney cancer and CT imaging data\")\n\
      \n# Search for subjects with kidney-related cancer that have annotated somatic\
      \ mutation data\nmutation_subjects = cda.get_subject_data(\n    match_all=['primary_site\
      \ = *kidney*', 'file_type = Annotated Somatic Mutation'],\n    add_columns=['file.*']\n\
      )\n\nprint(f\"Found {len(mutation_subjects)} subjects with kidney cancer and\
      \ annotated somatic mutation data\")\n\n# Find subjects that appear in both\
      \ datasets (have both CT and mutation data)\nct_subject_ids = set(ct_subjects['subject_id'])\n\
      mutation_subject_ids = set(mutation_subjects['subject_id'])\n\n# Find intersection\n\
      subjects_with_both = ct_subject_ids.intersection(mutation_subject_ids)\n\nprint(f\"\
      Subjects with CT imaging data: {len(ct_subject_ids)}\")\nprint(f\"Subjects with\
      \ mutation data: {len(mutation_subject_ids)}\")\nprint(f\"Subjects with BOTH\
      \ CT and mutation data: {len(subjects_with_both)}\")\n\n# Get detailed information\
      \ for subjects with both data types\nif len(subjects_with_both) > 0:\n    both_ct\
      \ = ct_subjects[ct_subjects['subject_id'].isin(subjects_with_both)]\n    both_mutation\
      \ = mutation_subjects[mutation_subjects['subject_id'].isin(subjects_with_both)]\n\
      \    \n    print(f\"\\nData source distribution:\")\n    print(\"CT data sources:\"\
      , both_ct['data_source'].explode().value_counts().to_dict())\n    print(\"Mutation\
      \ data sources:\", both_mutation['data_source'].explode().value_counts().to_dict())\n\
      \    \n    print(f\"\\nAccess levels:\")\n    print(\"CT data access:\", both_ct['access'].explode().value_counts().to_dict())\n\
      \    print(\"Mutation data access:\", both_mutation['access'].explode().value_counts().to_dict())"
    integration: 3a97a492-4947-4cb1-9b40-4dcfbdeee3f3
    notes: |-
      This example demonstrates how to find subjects with kidney cancer that have both CT imaging and sequencing data from CDA. Key points: 1) Use wildcard search (*kidney*) for primary_site to catch all kidney-related cancers, 2) Perform separate searches with specific file_type filters ('CT*' and 'Annotated Somatic Mutation'), 3) Use add_columns=['file.*'] to get file metadata, 4) Find intersection of subject IDs to identify subjects with both data types, 5) Analyze data sources and access levels. The example found 263 subjects with both CT (open access DICOM) and mutation data (controlled access MAF/VCF files) from multiple data commons (GDC, IDC, PDC, CDS).
    query: Find subjects that have kidney cancer with both CT and sequencing data
    resource_id: 172e3313-4a85-4c01-9c7e-6712bbd47b4e
    resource_type: example
  4d6b5148-5f1f-4942-83f0-36bad920de8d:
    code: |-
      import cdapython as cda
      import pandas as pd

      # subject (str): Subject ID (e.g., "TCGA.TCGA-BP-5168")
      patientId = ""
      files = cda.get_file_data(
          match_all=[f'subject_id = {subject}', 'access = open'],
          # CRITICAL: do not change the below line.
          add_columns=['file_name', 'file_type', 'access']
      )

      files
    integration: 3a97a492-4947-4cb1-9b40-4dcfbdeee3f3
    notes: Fetches the DRS URIs and dataframe of all of the files for a given subject
      ID
    query: List all open access files for a given subject ID
    resource_id: 4d6b5148-5f1f-4942-83f0-36bad920de8d
    resource_type: example
  52a61321-e035-4c58-91f5-42d61d939c13:
    code: "import cdapython as cda\nimport pandas as pd\nimport requests\nimport os\n\
      import time\n\n# Step 1: Query CDA for all open access files for a specific\
      \ subject\nsubject = \"TCGA.TCGA-BP-5168\"  # Replace with your subject ID\n\
      files = cda.get_file_data(\n    match_all=[f'subject_id = {subject}', 'access\
      \ = open'],\n    # IMPORTANT: Do not modify the below line.\n    add_columns=['file_name', 'file_type', 'access']\n)\n\nprint(f\"\
      Found {len(files)} open access files for patient {subject}\")\n\n# Step 2: Create\
      \ download directory\ndownload_path = f\"{subject.replace('.', '_')}_files\"\
      \nos.makedirs(download_path, exist_ok=True)\n\n# Step 3: Download function using\
      \ DRS URIs\ndef download_file_from_drs(drs_uri, download_path, filename=None):\n\
      \    \"\"\"Download a file using its DRS URI\"\"\"\n    try:\n        if not\
      \ drs_uri.startswith(\"drs://\"):\n            print(f\"Invalid DRS URI: {drs_uri}\"\
      )\n            return False\n            \n        object_id = drs_uri.split(\"\
      :\")[-1]\n        url = f\"https://nci-crdc.datacommons.io/ga4gh/drs/v1/objects/{object_id}\"\
      \n        \n        response = requests.get(url)\n        response.raise_for_status()\n\
      \        file_info = response.json()\n        \n        if not filename:\n \
      \           filename = file_info.get('name', f'file_{object_id}')\n        \n\
      \        # Find HTTPS download URL\n        https_url = None\n        for access_method\
      \ in file_info.get('access_methods', []):\n            if access_method.get('type')\
      \ == 'https':\n                https_url = access_method['access_url']['url']\n\
      \                break\n        \n        if https_url:\n            file_size\
      \ = file_info.get('size', 'unknown size')\n            print(f\"Downloading:\
      \ {filename} ({file_size} bytes)\")\n            file_response = requests.get(https_url,\
      \ stream=True)\n            file_response.raise_for_status()\n            file_path\
      \ = os.path.join(download_path, filename)\n            with open(file_path,\
      \ 'wb') as f:\n                for chunk in file_response.iter_content(chunk_size=8192):\n\
      \                    f.write(chunk)\n            return True\n        else:\n\
      \            print(f\"Failed to find HTTPS download link: {file_info}\")\n \
      \           return False\n            \n    except Exception as e:\n       \
      \ print(f\"Error downloading {filename}: {str(e)}\")\n        return False\n\
      \n# Step 4: Download all files\nsuccessful_downloads = 0\nfailed_downloads =\
      \ 0\n\nfor idx, row in files.iterrows():\n    drs_uri = row['drs_uri']\n   \
      \ filename = row['file_name']\n    \n    if pd.isna(filename) or filename ==\
      \ '':\n        print(f\"Skipping file {idx+1}: No filename available\")\n  \
      \      failed_downloads += 1\n        continue\n    \n    print(f\"\\nDownloading\
      \ file {idx+1}/{len(files)}: {filename}\")\n    success = download_file_from_drs(drs_uri,\
      \ download_path, filename)\n    \n    if success:\n        successful_downloads\
      \ += 1\n    else:\n        failed_downloads += 1\n    \n    # Small delay to\
      \ be respectful to the server\n    time.sleep(0.1)\n\n# Step 5: Summary\nprint(f\"\
      \\nDownload Summary:\")\nprint(f\"\u2713 Successful: {successful_downloads}\"\
      )\nprint(f\"\u2717 Failed: {failed_downloads}\")\nprint(f\"Files saved to: {os.path.abspath(download_path)}\"\
      )\n\n# Step 6: Analyze downloaded files by type\ndownloaded_files = os.listdir(download_path)\n\
      file_types = {}\ntotal_size = 0\n\nfor filename in downloaded_files:\n    file_path\
      \ = os.path.join(download_path, filename)\n    file_size = os.path.getsize(file_path)\n\
      \    total_size += file_size\n    \n    if '.' in filename:\n        ext = filename.split('.')[-1].lower()\n\
      \        if ext not in file_types:\n            file_types[ext] = []\n     \
      \   file_types[ext].append([filename, file_size])\n\nprint(f\"\\nFile types\
      \ downloaded:\")\nfor ext, file_list in file_types.items():\n    print(f\"{ext.upper()}:\
      \ {len(file_list)} files\")\n\nprint(f\"\\nTotal size: {total_size:,} bytes\
      \ ({total_size/1024/1024/1024:.2f} GB)\")"
    integration: 3a97a492-4947-4cb1-9b40-4dcfbdeee3f3
    notes: |-
      This example demonstrates a complete workflow for finding and downloading all open access files for a specific patient/subject from the Cancer Data Aggregator (CDA). The workflow includes: 1) Querying CDA for open access files using subject_id filter, 2) Creating organized download directory, 3) Using DRS URIs to download files with proper error handling, 4) Providing download progress and summary statistics, and 5) Analyzing the downloaded files by type and size. This is particularly useful for researchers who want to obtain comprehensive molecular and clinical data for specific cancer patients from TCGA and other programs. The example successfully downloaded 45 files totaling 1.3GB including genomics, transcriptomics, proteomics, imaging, and clinical data.
    query: List and download all open access files for a specific subject ID from
      CDA
    resource_id: 52a61321-e035-4c58-91f5-42d61d939c13
    resource_type: example
  61bdf3b5-9a6a-478d-aeb0-bad6e54578cc:
    code: |-
      import cdapython as cda

      # Get breast cancer subjects from GDC
      gdc_subjects = cda.get_subject_data(
          data_source='GDC',
          match_all=['primary_site = Breast']
      )

      # Get breast cancer subjects from IDC
      idc_subjects = cda.get_subject_data(
          data_source='IDC',
          match_all=['primary_site = Breast']
      )

      # Find subjects present in both GDC and IDC
      common_subjects = cda.intersect_subject_results(gdc_subjects, idc_subjects)

      # Print the number of subjects
      print(len(common_subjects))
    integration: 3a97a492-4947-4cb1-9b40-4dcfbdeee3f3
    notes: |-
      This example demonstrates how to retrieve and intersect subject data from the Genomic Data Commons (GDC) and the Imaging Data Commons (IDC) specifically for breast cancer subjects.
    query: Find subjects in GDC and IDC dealing with breast cancer.
    resource_id: 61bdf3b5-9a6a-478d-aeb0-bad6e54578cc
    resource_type: example
  b255a3f1-bede-43d6-b7da-0c69d77654d7:
    code: |-
      import cdapython as cda
      import pandas as pd
      import matplotlib.pyplot as plt

      # Retrieve subjects data
      subjects = cda.get_subject_data(
          match_all=['diagnosis = *adenocarcinoma*', 'age_at_observation != NULL'],
          add_columns=['age_at_observation']
      )

      # Extracting ages from the subjects DataFrame
      ages = subjects['age_at_observation'].explode().astype(int)

      # Plotting the histogram
      plt.figure(figsize=(10, 6))
      plt.hist(ages, bins=20, color='blue', alpha=0.7)
      plt.title('Histogram of Ages of Adenocarcinoma Subjects')
      plt.xlabel('Age at Observation')
      plt.ylabel('Frequency')
      plt.grid(axis='y', alpha=0.75)
      plt.show()
    integration: 3a97a492-4947-4cb1-9b40-4dcfbdeee3f3
    notes: |-
      This example demonstrates how to retrieve age data for adenocarcinoma subjects and plot a histogram of their ages, filtering for human subjects and excluding NULL values.
    query: Plot a histogram of the ages of adenocarcinoma subjects, filtering for
      humans and age_at_observation not NULL.
    resource_id: b255a3f1-bede-43d6-b7da-0c69d77654d7
    resource_type: example
  dc34d556-1d5d-4713-b0fa-59dc200f9acc:
    filepath: DOCUMENTATION.md
    integration: 3a97a492-4947-4cb1-9b40-4dcfbdeee3f3
    name: DOCUMENTATION
    resource_id: dc34d556-1d5d-4713-b0fa-59dc200f9acc
    resource_type: file
slug: cancer_data_aggregator
source: '{{DOCUMENTATION}}'
url: null
uuid: 3a97a492-4947-4cb1-9b40-4dcfbdeee3f3
