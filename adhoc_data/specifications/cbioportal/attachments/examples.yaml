- query: Query and display all colorectal cancer studies from cBioPortal. This example
    searches for studies with cancer type IDs 'coadread', 'coad', and 'read' (representing
    colorectal adenocarcinoma, colon adenocarcinoma, and rectal adenocarcinoma respectively).
    For each study, it displays the name, study ID, description, and cancer type ID.
  code: |
    import requests

    url = "https://www.cbioportal.org/api/studies"
    response = requests.get(url)

    if response.status_code == 200:
        studies = response.json()
        colorectal_studies = [study for study in studies if study['cancerTypeId'].lower() in ['coadread', 'coad', 'read']]
        print(f"Found {len(colorectal_studies)} colorectal cancer studies.")
        print("\nStudy Details:")
        for study in colorectal_studies:
            print(f"\nName: {study['name']}")
            print(f"Study ID: {study['studyId']}")
            print(f"Description: {study['description']}")
            print(f"Cancer Type ID: {study['cancerTypeId']}")
            print("-" * 80)
- query: Query mutation data from cBioPortal for a specific study (Genentech colorectal
    cancer study) and analyze mutations in key cancer genes (APC, TP53, KRAS, PIK3CA)
  notes: |
    The example demonstrates how to:
    1. Get sample IDs for a study
    2. Fetch mutation data using the molecular profiles endpoint
    3. Filter and analyze mutations for specific genes
    4. Count mutation types and protein changes
    The code provides a detailed breakdown of mutation types and frequencies for each gene.
  code: |
    import requests
    import json

    # Get samples for the study
    study_id = "coadread_genentech"
    samples_url = f"https://www.cbioportal.org/api/studies/{study_id}/samples"
    samples_response = requests.get(samples_url)

    if samples_response.status_code == 200:
        samples = json.loads(samples_response.content)
        sample_ids = [sample['sampleId'] for sample in samples]
        print(f"Found {len(sample_ids)} samples")

        # Get mutation data
        mutations_url = f"https://www.cbioportal.org/api/molecular-profiles/{study_id}_mutations/mutations/fetch"

        # Create the filter with sample IDs
        data = {
            "sampleIds": sample_ids
        }

        # Make the POST request
        mutations_response = requests.post(mutations_url, json=data)

        if mutations_response.status_code == 200:
            mutations = json.loads(mutations_response.content)
            print(f"\nRetrieved {len(mutations)} mutations")

            # Focus on key cancer genes
            key_genes = {
                'APC': 324,    # EntrezGeneID for APC
                'TP53': 7157,  # EntrezGeneID for TP53
                'KRAS': 3845,  # EntrezGeneID for KRAS
                'PIK3CA': 5290 # EntrezGeneID for PIK3CA
            }

            # Analyze mutations for these genes
            gene_details = {}
            for gene_symbol, gene_id in key_genes.items():
                gene_mutations = [m for m in mutations if m['entrezGeneId'] == gene_id]

                # Count mutation types
                mutation_types = {}
                protein_changes = []

                for mutation in gene_mutations:
                    mut_type = mutation['mutationType']
                    if mut_type in mutation_types:
                        mutation_types[mut_type] += 1
                    else:
                        mutation_types[mut_type] = 1

                    if mutation['proteinChange']:
                        protein_changes.append(mutation['proteinChange'])

                gene_details[gene_symbol] = {
                    'total_mutations': len(gene_mutations),
                    'mutation_types': mutation_types,
                    'protein_changes': protein_changes
                }

            # Print detailed analysis
            print("\nDetailed Analysis of Key Cancer Genes:\n")
            for gene, details in gene_details.items():
                print(f"\n{gene} Analysis:")
                print(f"Total mutations: {details['total_mutations']}")

                print("Mutation types:")
                for mut_type, count in details['mutation_types'].items():
                    print(f"  - {mut_type}: {count}")

                print("Protein changes (top 5):")
                for change in details['protein_changes'][:5]:
                    print(f"  - {change}")
                if len(details['protein_changes']) > 5:
                    print(f"  ... and {len(details['protein_changes'])-5} more changes")
- query: Query for studies related to colorectal cancer using the cancerTypeId 'coadread'.
  code: |
    import requests
    import pandas as pd

    # cBioPortal API base URL
    base_url = "https://www.cbioportal.org/api"

    # Endpoint to fetch studies
    endpoint = "/studies"

    # Parameters for the query
    params = {"cancerTypeId": "coadread"}

    # Make the API request
    response = requests.get(base_url + endpoint, params=params)

    # Check for successful response
    response.raise_for_status()

    # Parse the JSON response
    studies = response.json()

    # Create a pandas DataFrame from the results
    df = pd.DataFrame(studies)

    # Print the DataFrame
    print(df)
- query: Fetch and filter studies related to Acute Myeloid Leukemia (AML) from cBioPortal
    API.
  code: |
    import requests
    import pandas as pd

    def fetch_aml_studies():
        # Base URL for cBioPortal API
        base_url = "https://www.cbioportal.org/api"

        # Get all studies
        response = requests.get(f"{base_url}/studies")

        if response.status_code != 200:
            raise Exception(f"API request failed with status code {response.status_code}")

        # Get all studies as JSON
        studies = response.json()

        # Filter for AML related studies
        aml_studies = []
        for study in studies:
            # Convert all fields to lowercase for case-insensitive search
            study_id = study.get('studyId', '').lower()
            name = study.get('name', '').lower()
            cancer_type = study.get('cancerTypeId', '').lower()
            description = study.get('description', '').lower()

            # Check if 'aml' appears in any of the relevant fields
            if any('aml' in field for field in [study_id, name, cancer_type, description]):
                aml_studies.append({
                    'studyId': study['studyId'],
                    'name': study['name'],
                    'description': study.get('description', 'N/A'),
                    'cancerTypeId': study.get('cancerTypeId', 'N/A'),
                    'sampleCount': study.get('allSampleCount', 0),
                    'status': study.get('status', 'N/A'),
                    'publicStudy': study.get('publicStudy', False)
                })

        # Convert to DataFrame for better display
        df = pd.DataFrame(aml_studies)

        # Sort by sample count descending
        df = df.sort_values('sampleCount', ascending=False)

        return df

    # Execute the function
    aml_studies_df = fetch_aml_studies()
    print(f"Found {len(aml_studies_df)} AML-related studies")
    print(aml_studies_df)
- query: This example demonstrates how to fetch and analyze mutation data for a specific
    study in cBioPortal
  notes: |
    It shows:
    1. How to properly construct the API endpoint URL with sample list ID
    2. How to fetch mutation data for a study
    3. How to get gene symbol information using entrez IDs
    4. How to create a comprehensive mutation analysis including:
       - Total mutation counts
       - Gene frequency analysis
       - Mutation type distribution
       - Sample statistics
    The example uses the TARGET AML (GDC) study but can be modified for any study by changing the study_id.
  code: |
    import requests
    import pandas as pd
    from collections import Counter
    import numpy as np

    # Base URL for cBioPortal API
    base_url = "https://www.cbioportal.org/api"
    study_id = "aml_target_gdc"  # Example study ID

    # Get mutations using the sample list ID
    mutations_url = f"{base_url}/molecular-profiles/{study_id}_mutations/mutations?sampleListId={study_id}_all"
    mutations_response = requests.get(mutations_url)

    if mutations_response.status_code == 200:
        mutations_data = mutations_response.json()
        mutations_df = pd.DataFrame(mutations_data)

        # Get gene information for the entrez IDs
        entrez_ids = [int(x) for x in mutations_df['entrezGeneId'].unique()]  # Convert to regular Python integers
        genes_url = f"{base_url}/genes/fetch"
        genes_response = requests.post(genes_url, json=entrez_ids)

        if genes_response.status_code == 200:
            genes_data = genes_response.json()
            gene_map = {gene['entrezGeneId']: gene['hugoGeneSymbol'] for gene in genes_data}

            # Add gene symbols to mutations dataframe
            mutations_df['gene_symbol'] = mutations_df['entrezGeneId'].map(gene_map)

            # Print summary statistics
            print(f"Total mutations found: {len(mutations_df)}")
            print(f"Number of affected genes: {len(mutations_df['gene_symbol'].unique())}")

            print("\nMost frequently mutated genes:")
            print(mutations_df['gene_symbol'].value_counts().head(10))

            print("\nMutation types distribution:")
            print(mutations_df['mutationType'].value_counts())

            print("\nSample of mutations (first 5 rows):")
            display_cols = ['gene_symbol', 'sampleId', 'mutationType', 'proteinChange', 'chr', 'startPosition', 'variantType']
            print(mutations_df[display_cols].head())

            # Calculate sample statistics
            samples_with_mutations = len(mutations_df['sampleId'].unique())
            print(f"\nNumber of samples with mutations: {samples_with_mutations}")

            avg_mutations_per_sample = len(mutations_df) / samples_with_mutations
            print(f"Average mutations per sample: {avg_mutations_per_sample:.2f}")
    else:
        print(f"Error fetching mutations: {mutations_response.status_code}")
        print("Response:", mutations_response.text)
- query: Retrieve and analyze mutation data from multiple AML studies, including data
    processing and summary statistics. This example demonstrates how to fetch mutations
    across multiple studies, handle the nested JSON response, and create a comprehensive
    mutation dataset with key information.
  code: |
    import requests
    import pandas as pd
    import json

    # Base URL
    BASE_URL = "https://www.cbioportal.org/api"

    # List of AML studies
    AML_STUDIES = [
        'aml_target_2018_pub',
        'aml_ohsu_2018',
        'aml_ohsu_2022',
        'laml_tcga',
        'laml_tcga_pan_can_atlas_2018',
        'laml_tcga_gdac',
        'aml_target_gdc',
        'washu_pdi_2016',
        'laml_tcga_pub'
    ]

    # Function to get mutations for a study
    def get_study_mutations(study_id):
        print(f"\nProcessing study: {study_id}")

        # Get the molecular profile ID
        molecular_profile_id = f"{study_id}_mutations"

        # Get the sample list ID
        sample_list_id = f"{study_id}_all"

        # Fetch mutations
        mutations_response = requests.get(
            f"{BASE_URL}/molecular-profiles/{molecular_profile_id}/mutations",
            params={"sampleListId": sample_list_id, "projection": "DETAILED"}
        )

        if mutations_response.status_code == 200:
            mutations = mutations_response.json()
            print(f"Found {len(mutations)} mutations")

            # Convert to DataFrame
            mutations_df = pd.DataFrame(mutations)

            # Extract gene symbols from the nested dictionary
            mutations_df['gene_symbol'] = mutations_df['gene'].apply(lambda x: x['hugoGeneSymbol'])

            # Create a more focused DataFrame with key columns
            focused_df = mutations_df[[
                'gene_symbol',
                'sampleId',
                'proteinChange',
                'mutationType',
                'chr',
                'startPosition',
                'endPosition',
                'referenceAllele',
                'variantAllele'
            ]]

            return focused_df
        else:
            print(f"Error fetching mutations: {mutations_response.text}")
            return None

    # Process all studies
    all_mutations_dfs = []

    for study_id in AML_STUDIES:
        study_df = get_study_mutations(study_id)
        if study_df is not None:
            study_df['study_id'] = study_id  # Add study ID column
            all_mutations_dfs.append(study_df)

    # Combine all mutations
    if all_mutations_dfs:
        combined_df = pd.concat(all_mutations_dfs, ignore_index=True)

        print("\nOverall mutation data summary:")
        print(f"Total number of mutations: {len(combined_df)}")
        print(f"Number of unique genes: {combined_df['gene_symbol'].nunique()}")
        print(f"Number of unique samples: {combined_df['sampleId'].nunique()}")

        print("\nTop 20 most frequently mutated genes across all studies:")
        print(combined_df['gene_symbol'].value_counts().head(20))

        print("\nDistribution of mutation types:")
        print(combined_df['mutationType'].value_counts())

        print("\nNumber of mutations by study:")
        print(combined_df['study_id'].value_counts())

        # Save to CSV
        combined_df.to_csv('all_aml_mutations.csv', index=False)
- query: Example showing how to retrieve and analyze the molecular profiles available
    for multiple studies from cBioPortal. The code demonstrates how to fetch metadata
    on the molecular profiles, organize them into DataFrames, and analyze specific
    information about each profile like the types of profiles available such as RNA
    expression.
  code: |
    import requests
    import pandas as pd
    from typing import List, Dict

    def get_molecular_profiles(study_ids: List[str]) -> Dict[str, pd.DataFrame]:
        """
        Retrieve molecular profiles for multiple studies from cBioPortal.

        Args:
            study_ids: List of cBioPortal study IDs

        Returns:
            Dictionary mapping study IDs to DataFrames containing their molecular profiles
        """
        # Base URL for cBioPortal's web API
        base_url = "https://www.cbioportal.org/api"

        # Dictionary to store results
        results = {}

        print("Fetching molecular profiles...")
        for study_id in study_ids:
            print(f"\nStudy: {study_id}")
            print("-" * 40)

            # Get molecular profiles for this study
            response = requests.get(f"{base_url}/studies/{study_id}/molecular-profiles")

            if response.status_code == 200:
                profiles = response.json()

                # Create a summary DataFrame
                profile_data = []
                for profile in profiles:
                    profile_data.append({
                        'molecularProfileId': profile['molecularProfileId'],
                        'name': profile['name'],
                        'datatype': profile['datatype'],
                        'molecularAlterationType': profile['molecularAlterationType'],
                        'description': profile.get('description', 'N/A')
                    })

                if profile_data:
                    df = pd.DataFrame(profile_data)
                    results[study_id] = df
                    print(f"Found {len(df)} molecular profiles")

                    # Display summary of profile types
                    print("\nProfile types:")
                    type_summary = df.groupby('molecularAlterationType')['molecularProfileId'].count()
                    print(type_summary)
                else:
                    print("No molecular profiles found")
                    results[study_id] = pd.DataFrame()
            else:
                print(f"Error accessing study: {response.status_code}")
                results[study_id] = pd.DataFrame()

        return results

    # Example usage with AML studies
    aml_studies = [
        'aml_target_2018_pub',
        'aml_ohsu_2018',
        'aml_ohsu_2022',
        'laml_tcga',
        'laml_tcga_pan_can_atlas_2018',
        'aml_target_gdc',
        'mnm_washu_2016'
    ]

    # Get molecular profiles for all studies
    profiles_by_study = get_molecular_profiles(aml_studies)

    # Example of how to work with the results - get RNA expression profiles for first study
    first_study = list(profiles_by_study.keys())[0]
    if not profiles_by_study[first_study].empty:
        rna_profiles = profiles_by_study[first_study][
            profiles_by_study[first_study]['molecularAlterationType'] == 'MRNA_EXPRESSION'
        ]
        print(f"\nRNA expression profiles for {first_study}:")
        print(rna_profiles[['molecularProfileId', 'name', 'datatype']].to_string())
- query: Example of how to fetch RNA-seq z-scores for STAT5A and STAT5B across multiple
    AML studies
  notes: |
    This example demonstrates:
    1. How to properly fetch sample IDs for each study
    2. How to use these sample IDs when requesting molecular data
    3. How to handle large requests by processing samples in chunks
    4. How to combine data from multiple studies into a single dataframe
    5. How to create both long and wide format versions of the data

    Key points:
    - Must provide explicit sample IDs in the molecular data request
    - Z-scores are pre-calculated by cBioPortal for each study
    - Different studies may use different measurement types (TPM, RPKM, RSEM)
    - Processing in chunks helps avoid timeouts with large datasets
  code: |
    import requests
    import pandas as pd
    import time

    # Configuration
    BASE_URL = "https://www.cbioportal.org/api"

    # Define studies and their RNA-seq profiles
    STUDY_PROFILES = {
        'aml_target_gdc': {
            'name': 'TARGET-AML (GDC)',
            'profile': 'aml_target_gdc_mrna_seq_tpm_Zscores',
            'type': 'TPM'
        },
        'aml_ohsu_2022': {
            'name': 'OHSU AML 2022',
            'profile': 'aml_ohsu_2022_mrna_median_Zscores',
            'type': 'RPKM'
        }
        # ... other studies ...
    }

    # Define STAT5 genes with their Entrez IDs
    STAT5_GENES = {
        6776: 'STAT5A',
        6777: 'STAT5B'
    }

    # Function to get RNA-seq samples for a study
    def get_rna_seq_samples(study_id):
        """Get list of sample IDs that have RNA-seq data for a study."""
        url = f"{BASE_URL}/studies/{study_id}/sample-lists"
        response = requests.get(url)
        if response.status_code == 200:
            sample_lists = response.json()
            # Find RNA-seq sample list
            rna_list = next((sl['sampleListId'] for sl in sample_lists
                            if sl['category'] == 'all_cases_with_mrna_rnaseq_data'), None)
            if rna_list:
                # Get sample IDs from the list
                url = f"{BASE_URL}/sample-lists/{rna_list}/sample-ids"
                response = requests.get(url)
                if response.status_code == 200:
                    return response.json()
        return None

    # Function to get expression data
    def get_expression_data(profile_id, gene_ids, sample_ids):
        """Fetch expression z-scores for specific genes and samples."""
        url = f"{BASE_URL}/molecular-profiles/{profile_id}/molecular-data/fetch"
        # IMPORTANT: Must provide sample IDs explicitly
        data = {
            "sampleIds": sample_ids,  # List of specific sample IDs
            "entrezGeneIds": gene_ids  # List of Entrez gene IDs
        }
        response = requests.post(url, json=data)
        if response.status_code == 200:
            return response.json()
        return None

    # Process each study
    all_study_data = []

    for study_id, study_info in STUDY_PROFILES.items():
        print(f"\nProcessing {study_info['name']}...")

        # First get the sample IDs for the study
        sample_ids = get_rna_seq_samples(study_id)

        if sample_ids:
            print(f"Found {len(sample_ids)} RNA-seq samples")

            # Process samples in chunks to avoid large requests
            chunk_size = 100
            study_data = []

            for i in range(0, len(sample_ids), chunk_size):
                chunk = sample_ids[i:i + chunk_size]
                print(f"Fetching data for samples {i+1}-{i+len(chunk)}...")

                # Get expression data for this chunk of samples
                expression_data = get_expression_data(
                    study_info['profile'],
                    list(STAT5_GENES.keys()),
                    chunk
                )

                if expression_data:
                    study_data.extend(expression_data)
                time.sleep(0.2)  # Small delay between requests

            if study_data:
                # Convert to DataFrame
                df = pd.DataFrame(study_data)

                # Add metadata
                df['gene_symbol'] = df['entrezGeneId'].map(STAT5_GENES)
                df['study_id'] = study_id
                df['study_name'] = study_info['name']
                df['measurement_type'] = study_info['type']

                # Select and rename columns
                df = df[[
                    'study_id', 'study_name', 'measurement_type',
                    'gene_symbol', 'sampleId', 'value'
                ]]
                df.columns = [
                    'study_id', 'study_name', 'measurement_type',
                    'gene', 'sample_id', 'zscore'
                ]

                all_study_data.append(df)

    # Combine all data
    if all_study_data:
        # Create long format
        combined_df = pd.concat(all_study_data, ignore_index=True)

        # Create wide format (samples as rows, genes as columns)
        combined_wide = combined_df.pivot_table(
            index=['study_id', 'study_name', 'measurement_type', 'sample_id'],
            columns='gene',
            values='zscore'
        ).reset_index()

        # Save both versions
        stat5_all_studies = combined_df  # Long format
        stat5_all_studies_wide = combined_wide  # Wide format

    # Example of the resulting data structure:
    print("\nLong format example (first few rows):")
    print(stat5_all_studies.head())

    print("\nWide format example (first few rows):")
    print(stat5_all_studies_wide.head())
- query: Extract mutation and expression data for key oncogenes in TCGA lung adenocarcinoma
    for integrated analysis
  code: |-
    import requests
    import pandas as pd

    BASE_URL = "https://www.cbioportal.org/api"
    STUDY_ID = "luad_tcga_gdc"  # TCGA Lung Adenocarcinoma
    GENE_SYMBOLS = ["EGFR", "KRAS", "TP53", "STK11", "KEAP1"]

    # 1. Get mutation molecular profile ID
    profiles_url = f"{BASE_URL}/studies/{STUDY_ID}/molecular-profiles?projection=SUMMARY"
    profiles = requests.get(profiles_url).json()
    mutation_profiles = [p for p in profiles if p['molecularAlterationType'] == 'MUTATION_EXTENDED']
    mutation_profile_id = mutation_profiles[0]['molecularProfileId']

    # 2. Get gene information
    genes_url = f"{BASE_URL}/genes/fetch?geneIdType=HUGO_GENE_SYMBOL&projection=SUMMARY"
    genes_response = requests.post(genes_url, json=GENE_SYMBOLS)
    genes = genes_response.json()
    entrez_ids = [g['entrezGeneId'] for g in genes]

    # 3. Get sample list for all cases
    sample_lists_url = f"{BASE_URL}/studies/{STUDY_ID}/sample-lists?projection=SUMMARY"
    sample_lists = requests.get(sample_lists_url).json()
    all_sample_list = next(sl['stableId'] for sl in sample_lists if sl['category'] == 'all_cases_in_study')

    # 4. Fetch mutations for target genes
    mutations_url = f"{BASE_URL}/molecular-profiles/{mutation_profile_id}/mutations"
    params = {"sampleListId": all_sample_list, "projection": "DETAILED"}
    mutations_response = requests.get(mutations_url, params=params)
    mutations = mutations_response.json()

    # Filter for target genes
    mutations = [m for m in mutations if m['entrezGeneId'] in entrez_ids]

    # 5. Extract mutation data
    mutation_data = []
    for m in mutations:
        mutation_data.append({
            "sample_id": m['sampleId'],
            "gene_symbol": m['gene']['hugoGeneSymbol'],
            "protein_change": m.get('proteinChange', ''),
            "mutation_type": m.get('mutationType', ''),
            "chromosome": m.get('chr', ''),
            "start_position": m.get('startPosition', ''),
            "reference_allele": m.get('referenceAllele', ''),
            "variant_allele": m.get('tumorSeqAllele', '')
        })

    mutations_df = pd.DataFrame(mutation_data)
    print(f"Found {len(mutations_df)} mutations across {len(mutations_df['sample_id'].unique())} samples")
    print(f"Mutation frequency by gene:")
    print(mutations_df['gene_symbol'].value_counts())

    # 6. Get expression data for the same genes
    expr_profiles = [p for p in profiles if p['molecularAlterationType'] == 'MRNA_EXPRESSION']
    expr_profile_id = expr_profiles[0]['molecularProfileId']

    # Get expression sample list
    expr_sample_list = next(sl['stableId'] for sl in sample_lists if 'mrna' in sl['category'].lower())
    expr_samples_url = f"{BASE_URL}/sample-lists/{expr_sample_list}/sample-ids"
    expr_sample_ids = requests.get(expr_samples_url).json()

    # Fetch expression data
    expr_url = f"{BASE_URL}/molecular-profiles/{expr_profile_id}/molecular-data/fetch"
    expr_data = {"sampleIds": expr_sample_ids, "entrezGeneIds": entrez_ids}
    expr_response = requests.post(expr_url, json=expr_data)
    expression_data = expr_response.json()

    # Convert to DataFrame
    expr_df = pd.DataFrame(expression_data)
    entrez_to_symbol = {g['entrezGeneId']: g['hugoGeneSymbol'] for g in genes}
    expr_df['gene_symbol'] = expr_df['entrezGeneId'].map(entrez_to_symbol)
    expr_df = expr_df[['sampleId', 'gene_symbol', 'value']].rename(columns={'sampleId': 'sample_id', 'value': 'expression'})

    print(f"\nExpression data: {len(expr_df)} measurements across {len(expr_df['sample_id'].unique())} samples")
    print("Ready for mutation-expression correlation analysis!")
  notes: 'This example demonstrates the complete workflow for extracting both mutation
    and expression data from the same study, which is essential for correlating genetic
    alterations with their functional impact. The code handles the proper API endpoints,
    sample list management, and data formatting needed for downstream analysis. Key
    features: 1) Gets both mutation and expression profiles from the same study, 2)
    Uses proper sample lists for each data type, 3) Formats data consistently for
    integration, 4) Provides summary statistics for validation.'
- query: Find lung adenocarcinoma studies with both mutation and RNA expression data
  code: "import requests\nimport pandas as pd\n\nBASE_URL = \"https://www.cbioportal.org/api\"\
    \n\n# 1. Find lung adenocarcinoma studies with both mutation and expression data\n\
    studies_url = f\"{BASE_URL}/studies\"\nstudies = requests.get(studies_url).json()\n\
    \n# Filter for lung adenocarcinoma studies\nluad_studies = []\nfor study in studies:\n\
    \    name = study.get('name', '').lower()\n    description = study.get('description',\
    \ '').lower()\n    if ('lung' in name or 'lung' in description) and ('adenocarcinoma'\
    \ in name or 'adenocarcinoma' in description):\n        luad_studies.append(study)\n\
    \n# Check which studies have both mutation and expression data\nresults = []\n\
    for study in luad_studies:\n    study_id = study['studyId']\n    profiles_url\
    \ = f\"{BASE_URL}/studies/{study_id}/molecular-profiles\"\n    profiles = requests.get(profiles_url).json()\n\
    \    data_types = set(p['molecularAlterationType'] for p in profiles)\n    \n\
    \    has_mut = any(t in data_types for t in ['MUTATION_EXTENDED', 'MUTATION_UNCALLED'])\n\
    \    has_expr = any(t in data_types for t in ['MRNA_EXPRESSION', 'RNA_EXPRESSION'])\n\
    \    \n    if has_mut and has_expr:\n        results.append({\n            \"\
    studyId\": study_id,\n            \"name\": study['name'],\n            \"sampleCount\"\
    : study.get('allSampleCount', None),\n            \"dataTypes\": sorted(data_types)\n\
    \        })\n\ndf = pd.DataFrame(results)\nprint(f\"Found {len(df)} lung adenocarcinoma\
    \ studies with both mutation and expression data:\")\nprint(df.to_string(index=False))"
  notes: This example demonstrates how to search for cancer studies by disease type
    and filter for those containing both mutation and expression molecular profiles.
    Essential for multi-omics cancer research workflows.
- query: Calculate mutation frequencies for all genes in a cancer study
  code: |-
    import requests
    import pandas as pd

    BASE_URL = "https://www.cbioportal.org/api"
    STUDY_ID = "luad_tcga_gdc"

    # 1. Get mutation molecular profile ID
    profiles_url = f"{BASE_URL}/studies/{STUDY_ID}/molecular-profiles?projection=SUMMARY"
    profiles = requests.get(profiles_url).json()
    mutation_profiles = [p for p in profiles if p['molecularAlterationType'] == 'MUTATION_EXTENDED']
    mutation_profile_id = mutation_profiles[0]['molecularProfileId']

    # 2. Get sample list for mutation data
    sample_lists_url = f"{BASE_URL}/studies/{STUDY_ID}/sample-lists?projection=SUMMARY"
    sample_lists = requests.get(sample_lists_url).json()
    mutation_sample_list = next(sl['sampleListId'] for sl in sample_lists if sl['category'] == 'all_cases_with_mutation_data')

    # 3. Fetch all mutations
    mutations_url = f"{BASE_URL}/molecular-profiles/{mutation_profile_id}/mutations"
    params = {"sampleListId": mutation_sample_list, "projection": "SUMMARY"}
    mutations = requests.get(mutations_url, params=params).json()

    # 4. Map entrez gene IDs to symbols
    entrez_ids = list(set([m['entrezGeneId'] for m in mutations]))
    entrez_to_symbol = {}
    for i in range(0, len(entrez_ids), 500):
        chunk = entrez_ids[i:i+500]
        url = f"{BASE_URL}/genes/fetch?geneIdType=ENTREZ_GENE_ID&projection=SUMMARY"
        resp = requests.post(url, json=[str(eid) for eid in chunk])
        genes = resp.json()
        for g in genes:
            entrez_to_symbol[g['entrezGeneId']] = g['hugoGeneSymbol']

    # 5. Calculate mutation frequencies
    mutations_df = pd.DataFrame(mutations)
    mutations_df['gene_symbol'] = mutations_df['entrezGeneId'].map(entrez_to_symbol)

    # Count mutated samples per gene
    sample_counts = mutations_df.groupby('gene_symbol')['sampleId'].nunique().reset_index()
    sample_counts = sample_counts.rename(columns={'sampleId': 'mutated_samples'})

    # Calculate frequencies
    n_samples = mutations_df['sampleId'].nunique()
    sample_counts['frequency_percent'] = (sample_counts['mutated_samples'] / n_samples * 100).round(2)

    # Filter for >10% frequency and get top 20
    top_mutated = sample_counts[sample_counts['frequency_percent'] > 10].sort_values('mutated_samples', ascending=False).head(20)
    print("Top 20 most frequently mutated genes (>10% frequency):")
    print(top_mutated.to_string(index=False))
  notes: This example shows how to retrieve all mutations from a study, map gene IDs
    to symbols, and calculate mutation frequencies across samples. Useful for identifying
    driver genes and mutation burden analysis in cancer genomics.
- query: Compare RNA expression levels between mutated and wild-type samples for specific
    genes
  code: "import requests\nimport pandas as pd\nfrom scipy import stats\n\nBASE_URL\
    \ = \"https://www.cbioportal.org/api\"\nSTUDY_ID = \"luad_tcga_gdc\"\nGENE_SYMBOLS\
    \ = [\"TP53\", \"KRAS\", \"RYR2\"]\n\n# 1. Get molecular profile IDs\nprofiles_url\
    \ = f\"{BASE_URL}/studies/{STUDY_ID}/molecular-profiles?projection=SUMMARY\"\n\
    profiles = requests.get(profiles_url).json()\nmutation_profile_id = next(p['molecularProfileId']\
    \ for p in profiles if p['molecularAlterationType'] == 'MUTATION_EXTENDED')\n\
    expr_profile_id = next(p['molecularProfileId'] for p in profiles if p['molecularAlterationType']\
    \ == 'MRNA_EXPRESSION')\n\n# 2. Get gene information\ngenes_url = f\"{BASE_URL}/genes/fetch?geneIdType=HUGO_GENE_SYMBOL&projection=SUMMARY\"\
    \ngenes = requests.post(genes_url, json=GENE_SYMBOLS).json()\nentrez_ids = [g['entrezGeneId']\
    \ for g in genes]\nentrez_to_symbol = {g['entrezGeneId']: g['hugoGeneSymbol']\
    \ for g in genes}\n\n# 3. Get sample lists\nsample_lists_url = f\"{BASE_URL}/studies/{STUDY_ID}/sample-lists?projection=SUMMARY\"\
    \nsample_lists = requests.get(sample_lists_url).json()\nmutation_samples = next(sl['sampleListId']\
    \ for sl in sample_lists if sl['category'] == 'all_cases_with_mutation_data')\n\
    expr_samples = next(sl['sampleListId'] for sl in sample_lists if 'mrna' in sl['category'].lower())\n\
    \n# 4. Get mutations for target genes\nmutations_url = f\"{BASE_URL}/molecular-profiles/{mutation_profile_id}/mutations\"\
    \nparams = {\"sampleListId\": mutation_samples, \"projection\": \"SUMMARY\"}\n\
    mutations = requests.get(mutations_url, params=params).json()\ntarget_mutations\
    \ = [m for m in mutations if m['entrezGeneId'] in entrez_ids]\n\n# 5. Get expression\
    \ data\nexpr_samples_url = f\"{BASE_URL}/sample-lists/{expr_samples}/sample-ids\"\
    \nexpr_sample_ids = requests.get(expr_samples_url).json()\nexpr_url = f\"{BASE_URL}/molecular-profiles/{expr_profile_id}/molecular-data/fetch\"\
    \nexpr_data = {\"sampleIds\": expr_sample_ids, \"entrezGeneIds\": entrez_ids}\n\
    expression_data = requests.post(expr_url, json=expr_data).json()\n\n# 6. Create\
    \ mutation status mapping\nmutations_df = pd.DataFrame([{\n    \"sample_id\":\
    \ m['sampleId'],\n    \"gene_symbol\": entrez_to_symbol[m['entrezGeneId']]\n}\
    \ for m in target_mutations])\n\n# 7. Create expression dataframe\nexpr_df = pd.DataFrame(expression_data)\n\
    expr_df['gene_symbol'] = expr_df['entrezGeneId'].map(entrez_to_symbol)\nexpr_df\
    \ = expr_df[['sampleId', 'gene_symbol', 'value']].rename(columns={'sampleId':\
    \ 'sample_id', 'value': 'expression'})\n\n# 8. Analyze mutation-expression relationships\n\
    results = []\nfor gene in GENE_SYMBOLS:\n    mutated_samples = set(mutations_df.loc[mutations_df['gene_symbol']\
    \ == gene, 'sample_id'])\n    gene_expr = expr_df[expr_df['gene_symbol'] == gene].copy()\n\
    \    gene_expr['mutation_status'] = gene_expr['sample_id'].apply(lambda x: 'Mutated'\
    \ if x in mutated_samples else 'Wild-Type')\n    \n    # Statistical test\n  \
    \  mutated = gene_expr[gene_expr['mutation_status'] == 'Mutated']['expression']\n\
    \    wild_type = gene_expr[gene_expr['mutation_status'] == 'Wild-Type']['expression']\n\
    \    \n    if len(mutated) > 0 and len(wild_type) > 0:\n        statistic, p_value\
    \ = stats.mannwhitneyu(mutated, wild_type, alternative='two-sided')\n        fold_change\
    \ = mutated.mean() / wild_type.mean() if wild_type.mean() != 0 else 0\n      \
    \  \n        results.append({\n            'gene': gene,\n            'mutated_samples':\
    \ len(mutated),\n            'wild_type_samples': len(wild_type),\n          \
    \  'mutated_mean': mutated.mean(),\n            'wild_type_mean': wild_type.mean(),\n\
    \            'fold_change': fold_change,\n            'p_value': p_value\n   \
    \     })\n\nresults_df = pd.DataFrame(results)\nprint(\"Mutation-Expression Analysis\
    \ Results:\")\nprint(results_df.to_string(index=False))"
  notes: This example demonstrates how to integrate mutation and expression data to
    perform statistical comparisons between mutated and wild-type samples. Essential
    for understanding functional consequences of mutations in cancer genomics.
- query: Analyze co-mutation patterns between genes using Fisher's exact test
  code: "import requests\nimport pandas as pd\nfrom scipy.stats import fisher_exact\n\
    \nBASE_URL = \"https://www.cbioportal.org/api\"\nSTUDY_ID = \"luad_tcga_gdc\"\n\
    \n# Get mutation data (assuming mutations_df already exists from previous examples)\n\
    # mutations_df should contain columns: 'sampleId', 'gene_symbol'\n\n# Create mutation\
    \ matrix (samples x genes)\nmutation_matrix = mutations_df.pivot_table(\n    index='sampleId',\
    \ \n    columns='gene_symbol', \n    values='entrezGeneId', \n    aggfunc='count',\
    \ \n    fill_value=0\n)\nmutation_matrix = (mutation_matrix > 0).astype(int)\n\
    \n# Focus on top mutated genes\ntop_genes = ['TP53', 'TTN', 'MUC16', 'CSMD3',\
    \ 'RYR2', 'LRP1B', 'ZFHX4', 'USH2A', 'KRAS', 'XIRP2']\ntop_genes_matrix = mutation_matrix[top_genes]\n\
    \n# Calculate co-mutation frequencies\nco_mutation_results = []\nfor i, gene1\
    \ in enumerate(top_genes):\n    for j, gene2 in enumerate(top_genes):\n      \
    \  if i < j:  # Avoid duplicates\n            # Count co-mutations\n         \
    \   both_mutated = ((top_genes_matrix[gene1] == 1) & (top_genes_matrix[gene2]\
    \ == 1)).sum()\n            gene1_only = ((top_genes_matrix[gene1] == 1) & (top_genes_matrix[gene2]\
    \ == 0)).sum()\n            gene2_only = ((top_genes_matrix[gene1] == 0) & (top_genes_matrix[gene2]\
    \ == 1)).sum()\n            neither = ((top_genes_matrix[gene1] == 0) & (top_genes_matrix[gene2]\
    \ == 0)).sum()\n            \n            # Fisher's exact test for co-occurrence\n\
    \            contingency_table = [[both_mutated, gene1_only], [gene2_only, neither]]\n\
    \            odds_ratio, p_value = fisher_exact(contingency_table)\n         \
    \   \n            total_samples = len(top_genes_matrix)\n            co_mutation_rate\
    \ = (both_mutated / total_samples) * 100\n            \n            co_mutation_results.append({\n\
    \                'gene1': gene1,\n                'gene2': gene2,\n          \
    \      'co_mutations': both_mutated,\n                'co_mutation_rate': co_mutation_rate,\n\
    \                'odds_ratio': odds_ratio,\n                'p_value': p_value\n\
    \            })\n\n# Sort by co-mutation frequency and show significant pairs\n\
    co_mutation_df = pd.DataFrame(co_mutation_results)\nsignificant_pairs = co_mutation_df[co_mutation_df['p_value']\
    \ < 0.001].sort_values('co_mutations', ascending=False)\n\nprint(\"Significant\
    \ co-mutation pairs (p < 0.001):\")\nfor _, row in significant_pairs.head(10).iterrows():\n\
    \    significance = \"***\" if row['p_value'] < 0.001 else \"**\" if row['p_value']\
    \ < 0.01 else \"*\"\n    print(f\"{row['gene1']} & {row['gene2']}: {row['co_mutations']}\
    \ samples ({row['co_mutation_rate']:.1f}%) {significance}\")"
  notes: This example shows how to identify genes that are frequently mutated together
    in cancer samples using statistical testing. Useful for understanding mutational
    processes and identifying potential synthetic lethal relationships.
- query: Analyze specific mutations (e.g., KRAS G12C) in TCGA studies with expression
    comparison
  code: |-
    import requests
    import pandas as pd
    from scipy import stats
    import numpy as np

    BASE_URL = "https://www.cbioportal.org/api"
    STUDY_ID = "luad_tcga_gdc"
    GENE_SYMBOLS = ["KRAS"]

    # 1. Get molecular profile IDs
    profiles_url = f"{BASE_URL}/studies/{STUDY_ID}/molecular-profiles?projection=SUMMARY"
    profiles = requests.get(profiles_url).json()
    mutation_profile_id = next(p['molecularProfileId'] for p in profiles if p['molecularAlterationType'] == 'MUTATION_EXTENDED')
    expr_profile_id = next(p['molecularProfileId'] for p in profiles if p['molecularAlterationType'] == 'MRNA_EXPRESSION')

    # 2. Get gene information
    genes_url = f"{BASE_URL}/genes/fetch?geneIdType=HUGO_GENE_SYMBOL&projection=SUMMARY"
    genes = requests.post(genes_url, json=GENE_SYMBOLS).json()
    entrez_ids = [g['entrezGeneId'] for g in genes]

    # 3. Get sample lists
    sample_lists_url = f"{BASE_URL}/studies/{STUDY_ID}/sample-lists?projection=SUMMARY"
    sample_lists = requests.get(sample_lists_url).json()
    mutation_samples = next(sl['sampleListId'] for sl in sample_lists if sl['category'] == 'all_cases_with_mutation_data')
    expr_samples = next(sl['sampleListId'] for sl in sample_lists if 'mrna' in sl['category'].lower())

    # 4. Get detailed mutations for KRAS with protein changes
    mutations_url = f"{BASE_URL}/molecular-profiles/{mutation_profile_id}/mutations"
    params = {"sampleListId": mutation_samples, "projection": "DETAILED"}
    mutations = requests.get(mutations_url, params=params).json()
    kras_mutations = [m for m in mutations if m['entrezGeneId'] == entrez_ids[0]]

    # Create mutation dataframe with protein changes
    kras_df = pd.DataFrame([{
        "sample_id": m['sampleId'],
        "gene_symbol": m['gene']['hugoGeneSymbol'],
        "protein_change": m.get('proteinChange', 'Unknown'),
        "mutation_type": m.get('mutationType', 'Unknown'),
        "hgvsp_short": m.get('hgvspShort', 'Unknown'),
        "amino_acid_change": m.get('aminoAcidChange', 'Unknown')
    } for m in kras_mutations])

    # Filter for specific mutation (e.g., G12C)
    g12c_samples = kras_df[kras_df['protein_change'] == 'G12C']['sample_id'].tolist()
    print(f"G12C mutations found: {len(g12c_samples)}")

    # 5. Get expression data
    expr_samples_url = f"{BASE_URL}/sample-lists/{expr_samples}/sample-ids"
    expr_sample_ids = requests.get(expr_samples_url).json()

    expr_url = f"{BASE_URL}/molecular-profiles/{expr_profile_id}/molecular-data/fetch"
    expr_data = {"sampleIds": expr_sample_ids, "entrezGeneIds": entrez_ids}
    expression_data = requests.post(expr_url, json=expr_data).json()

    # Create expression dataframe
    expr_df = pd.DataFrame([{
        "sample_id": e['sampleId'],
        "expression": e['value']
    } for e in expression_data])

    # Map mutation status
    all_kras_mutated_samples = set(kras_df['sample_id'].tolist())
    mutation_status_map = {}
    for sample in g12c_samples:
        mutation_status_map[sample] = 'KRAS_G12C'
    for sample in all_kras_mutated_samples:
        if sample not in mutation_status_map:
            mutation_status_map[sample] = 'KRAS_Other'

    expr_df['mutation_status'] = expr_df['sample_id'].map(mutation_status_map).fillna('Wild_Type')

    # Statistical analysis
    g12c_expr = expr_df[expr_df['mutation_status'] == 'KRAS_G12C']['expression']
    wt_expr = expr_df[expr_df['mutation_status'] == 'Wild_Type']['expression']

    if len(g12c_expr) > 0 and len(wt_expr) > 0:
        statistic, p_value = stats.mannwhitneyu(g12c_expr, wt_expr, alternative='two-sided')
        fold_change = g12c_expr.mean() / wt_expr.mean()
        print(f"G12C vs Wild-Type: {fold_change:.2f}x fold change, p = {p_value:.2e}")

    print(f"Mutation distribution:\n{expr_df['mutation_status'].value_counts()}")
  notes: 'This example demonstrates how to: 1) Fetch detailed mutation data with protein
    changes from TCGA studies, 2) Filter for specific mutations like G12C, 3) Get
    corresponding expression data, 4) Compare expression levels between mutation groups,
    and 5) Perform statistical analysis. Key points: Use DETAILED projection for mutations
    to get protein changes, map mutation status to expression data, and use appropriate
    statistical tests for group comparisons.'
- query: Analyze IDH1 R132H mutations in TCGA glioblastoma with expression comparison
  code: "import requests\nimport pandas as pd\nfrom scipy import stats\nimport numpy\
    \ as np\n\nBASE_URL = \"https://www.cbioportal.org/api\"\nSTUDY_ID = \"gbm_tcga_gdc\"\
    \  # Glioblastoma study\nGENE_SYMBOLS = [\"IDH1\"]\n\n# 1. Get molecular profile\
    \ IDs\nprofiles_url = f\"{BASE_URL}/studies/{STUDY_ID}/molecular-profiles?projection=SUMMARY\"\
    \nprofiles = requests.get(profiles_url).json()\nmutation_profile_id = next(p['molecularProfileId']\
    \ for p in profiles if p['molecularAlterationType'] == 'MUTATION_EXTENDED')\n\
    expr_profile_id = next(p['molecularProfileId'] for p in profiles if p['molecularAlterationType']\
    \ == 'MRNA_EXPRESSION')\n\n# 2. Get gene information\ngenes_url = f\"{BASE_URL}/genes/fetch?geneIdType=HUGO_GENE_SYMBOL&projection=SUMMARY\"\
    \ngenes = requests.post(genes_url, json=GENE_SYMBOLS).json()\nentrez_ids = [g['entrezGeneId']\
    \ for g in genes]\n\n# 3. Get sample lists\nsample_lists_url = f\"{BASE_URL}/studies/{STUDY_ID}/sample-lists?projection=SUMMARY\"\
    \nsample_lists = requests.get(sample_lists_url).json()\nmutation_samples = next(sl['sampleListId']\
    \ for sl in sample_lists if sl['category'] == 'all_cases_with_mutation_data')\n\
    expr_samples = next(sl['sampleListId'] for sl in sample_lists if 'mrna' in sl['category'].lower())\n\
    \n# 4. Get detailed mutations for IDH1 with protein changes\nmutations_url = f\"\
    {BASE_URL}/molecular-profiles/{mutation_profile_id}/mutations\"\nparams = {\"\
    sampleListId\": mutation_samples, \"projection\": \"DETAILED\"}\nmutations = requests.get(mutations_url,\
    \ params=params).json()\nidh1_mutations = [m for m in mutations if m['entrezGeneId']\
    \ == entrez_ids[0]]\n\n# Create mutation dataframe with protein changes\nidh1_df\
    \ = pd.DataFrame([{\n    \"sample_id\": m['sampleId'],\n    \"gene_symbol\": m['gene']['hugoGeneSymbol'],\n\
    \    \"protein_change\": m.get('proteinChange', 'Unknown'),\n    \"mutation_type\"\
    : m.get('mutationType', 'Unknown'),\n    \"hgvsp_short\": m.get('hgvspShort',\
    \ 'Unknown'),\n    \"amino_acid_change\": m.get('aminoAcidChange', 'Unknown')\n\
    } for m in idh1_mutations])\n\n# Filter for R132H mutation specifically\nr132h_samples\
    \ = idh1_df[idh1_df['protein_change'] == 'R132H']['sample_id'].tolist()\nprint(f\"\
    IDH1 R132H mutations found: {len(r132h_samples)}\")\n\n# Show mutation distribution\n\
    mutation_counts = idh1_df['protein_change'].value_counts()\nprint(f\"IDH1 mutation\
    \ distribution:\\n{mutation_counts}\")\n\n# 5. Get expression data\nexpr_samples_url\
    \ = f\"{BASE_URL}/sample-lists/{expr_samples}/sample-ids\"\nexpr_sample_ids =\
    \ requests.get(expr_samples_url).json()\n\nexpr_url = f\"{BASE_URL}/molecular-profiles/{expr_profile_id}/molecular-data/fetch\"\
    \nexpr_data = {\"sampleIds\": expr_sample_ids, \"entrezGeneIds\": entrez_ids}\n\
    expression_data = requests.post(expr_url, json=expr_data).json()\n\n# Create expression\
    \ dataframe\nexpr_df = pd.DataFrame([{\n    \"sample_id\": e['sampleId'],\n  \
    \  \"expression\": e['value']\n} for e in expression_data])\n\n# Map mutation\
    \ status\nall_idh1_mutated_samples = set(idh1_df['sample_id'].tolist())\nmutation_status_map\
    \ = {}\nfor sample in r132h_samples:\n    mutation_status_map[sample] = 'IDH1_R132H'\n\
    for sample in all_idh1_mutated_samples:\n    if sample not in mutation_status_map:\n\
    \        mutation_status_map[sample] = 'IDH1_Other'\n\nexpr_df['mutation_status']\
    \ = expr_df['sample_id'].map(mutation_status_map).fillna('Wild_Type')\n\n# Statistical\
    \ analysis comparing R132H vs Wild-Type\nr132h_expr = expr_df[expr_df['mutation_status']\
    \ == 'IDH1_R132H']['expression']\nwt_expr = expr_df[expr_df['mutation_status']\
    \ == 'Wild_Type']['expression']\n\nif len(r132h_expr) > 0 and len(wt_expr) > 0:\n\
    \    statistic, p_value = stats.mannwhitneyu(r132h_expr, wt_expr, alternative='two-sided')\n\
    \    fold_change = r132h_expr.mean() / wt_expr.mean()\n    print(f\"\\nIDH1 R132H\
    \ vs Wild-Type:\")\n    print(f\"\u2022 R132H samples: {len(r132h_expr)}\")\n\
    \    print(f\"\u2022 Wild-type samples: {len(wt_expr)}\")\n    print(f\"\u2022\
    \ Fold change: {fold_change:.2f}x\")\n    print(f\"\u2022 P-value: {p_value:.2e}\"\
    )\n\n# Summary statistics\nsummary_stats = expr_df.groupby('mutation_status')['expression'].agg([\n\
    \    'count', 'mean', 'median', 'std'\n]).round(2)\nprint(f\"\\nExpression summary\
    \ by mutation status:\\n{summary_stats}\")\n\nprint(f\"\\nMutation status distribution:\\\
    n{expr_df['mutation_status'].value_counts()}\")"
  notes: 'This example demonstrates analyzing the IDH1 R132H mutation in glioblastoma,
    which is a metabolic reprogramming mutation that creates neomorphic enzyme activity.
    Key features: 1) Focuses on glioblastoma study where IDH1 mutations are most relevant,
    2) Specifically filters for R132H mutation (the most common IDH1 mutation), 3)
    Compares expression levels between R132H mutated and wild-type samples, 4) Provides
    statistical analysis and summary statistics. This mutation is particularly interesting
    because it changes enzyme function rather than just disrupting it, making it ideal
    for functional prediction tools like AlphaGenome.'
