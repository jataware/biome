- query: Basic gene expression prediction for a genomic interval
  code: |-
    import os
    from alphagenome.data import genome
    from alphagenome.models import dna_client

    # Setup AlphaGenome client
    API_KEY = os.environ.get("ALPHAGENOME_API_KEY")
    model = dna_client.create(API_KEY)

    # Define genomic interval
    interval = genome.Interval(
        chromosome='chr22',
        start=35677410,
        end=36725986
    )

    # Make prediction for liver tissue
    outputs = model.predict(
        interval=interval,
        ontology_terms=['UBERON:0001157'],  # Liver tissue
        requested_outputs=[dna_client.OutputType.RNA_SEQ],
    )

    # Access expression data
    expression_data = outputs.rna_seq
    print(f"Expression prediction shape: {expression_data.shape}")
    print(f"Genomic interval: {expression_data.interval}")
  notes: This example demonstrates basic gene expression prediction for a genomic
    interval in liver tissue. The TAL1 locus is used as an example region known for
    its role in hematopoiesis. The prediction returns RNA-seq expression levels at
    single base-pair resolution across the specified interval.
- query: Variant effect prediction and visualization
  code: |-
    import os
    from alphagenome.data import genome
    from alphagenome.models import dna_client
    from alphagenome.visualization import plot_components
    import matplotlib.pyplot as plt

    # Setup
    API_KEY = os.environ.get("ALPHAGENOME_API_KEY")
    model = dna_client.create(API_KEY)

    # Define genomic interval and variant
    interval = genome.Interval(
        chromosome='chr22',
        start=35677410,
        end=36725986
    )

    variant = genome.Variant(
        chromosome='chr22',
        position=36201698,
        reference_bases='A',
        alternate_bases='C',
    )

    # Predict variant effects
    outputs = model.predict_variant(
        interval=interval,
        variant=variant,
        ontology_terms=['UBERON:0001157'],
        requested_outputs=[dna_client.OutputType.RNA_SEQ],
    )

    # Visualize reference vs alternate
    plot_components.plot([
        plot_components.OverlaidTracks(
            tdata={
                'REF': outputs.reference.rna_seq,
                'ALT': outputs.alternate.rna_seq,
            },
            colors={'REF': 'dimgrey', 'ALT': 'red'},
        ),
    ],
        interval=outputs.reference.rna_seq.interval.resize(2**15),
        annotations=[plot_components.VariantAnnotation([variant], alpha=0.8)],
    )
    plt.title("Variant Effect on Gene Expression")
    plt.show()

    # Calculate effect size
    ref_mean = outputs.reference.rna_seq.values.mean()
    alt_mean = outputs.alternate.rna_seq.values.mean()
    effect_size = (alt_mean - ref_mean) / ref_mean
    print(f"Variant effect size: {effect_size:.4f}")
  notes: This example demonstrates variant effect prediction and visualization. It
    compares reference and alternate allele effects on gene expression and calculates
    the relative effect size. The visualization shows both predictions overlaid with
    the variant position annotated.
- query: Multi-tissue expression analysis
  code: |-
    import os
    from alphagenome.data import genome
    from alphagenome.models import dna_client
    import pandas as pd
    
    # Setup
    API_KEY = os.environ.get("ALPHAGENOME_API_KEY")
    model = dna_client.create(API_KEY)
    
    # Define genomic interval
    interval = genome.Interval(
        chromosome='chr22',
        start=35677410,
        end=36725986
    )
    
    # Define tissues of interest
    tissues = {
        'Liver': 'UBERON:0001157',
        'Lung': 'UBERON:0002048',
        'Brain': 'UBERON:0000955',
        'Heart': 'UBERON:0000948',
        'Kidney': 'UBERON:0002113'
    }
    
    # Predict expression across tissues
    tissue_results = {}
    for tissue_name, ontology_id in tissues.items():
        try:
            outputs = model.predict(
                interval=interval,
                ontology_terms=[ontology_id],
                requested_outputs=[dna_client.OutputType.RNA_SEQ],
            )
            tissue_results[tissue_name] = outputs.rna_seq.values.mean()
        except Exception as e:
            print(f"Error predicting {tissue_name}: {e}")
            tissue_results[tissue_name] = None
    
    # Create summary DataFrame
    df = pd.DataFrame(list(tissue_results.items()), 
                     columns=['Tissue', 'Mean_Expression'])
    df = df.dropna()
    df = df.sort_values('Mean_Expression', ascending=False)
    
    print("Expression levels across tissues:")
    print(df.to_string(index=False))
    
    # Find tissue with highest expression
    top_tissue = df.iloc[0]['Tissue']
    top_expression = df.iloc[0]['Mean_Expression']
    print(f"\nHighest expression in {top_tissue}: {top_expression:.4f}")
  notes: This example demonstrates multi-tissue expression analysis by predicting
    gene expression across different tissue types. It uses common tissue ontology
    terms and compares expression levels to identify tissue-specific patterns.
- query: Batch variant scoring for multiple SNPs
  code: |-
    import os
    from alphagenome.data import genome
    from alphagenome.models import dna_client
    import pandas as pd
    
    # Setup
    API_KEY = os.environ.get("ALPHAGENOME_API_KEY")
    model = dna_client.create(API_KEY)
    
    # Define genomic interval
    interval = genome.Interval(
        chromosome='chr22',
        start=35677410,
        end=36725986
    )
    
    # Define variants to analyze
    variants = [
        genome.Variant(chromosome='chr22', position=36201698, reference_bases='A', alternate_bases='C'),
        genome.Variant(chromosome='chr22', position=36201700, reference_bases='G', alternate_bases='T'),
        genome.Variant(chromosome='chr22', position=36201702, reference_bases='C', alternate_bases='G'),
        genome.Variant(chromosome='chr22', position=36201704, reference_bases='T', alternate_bases='A'),
    ]
    
    # Score all variants
    results = []
    for i, variant in enumerate(variants):
        try:
            outputs = model.predict_variant(
                interval=interval,
                variant=variant,
                ontology_terms=['UBERON:0001157'],  # Liver tissue
                requested_outputs=[dna_client.OutputType.RNA_SEQ],
            )
            
            # Calculate effect metrics
            ref_mean = outputs.reference.rna_seq.values.mean()
            alt_mean = outputs.alternate.rna_seq.values.mean()
            effect_size = (alt_mean - ref_mean) / ref_mean if ref_mean != 0 else 0
            
            results.append({
                'Variant_ID': f"var_{i+1}",
                'Chromosome': variant.chromosome,
                'Position': variant.position,
                'Reference': variant.reference_bases,
                'Alternate': variant.alternate_bases,
                'Ref_Expression': ref_mean,
                'Alt_Expression': alt_mean,
                'Effect_Size': effect_size,
                'Abs_Effect': abs(effect_size)
            })
            
        except Exception as e:
            print(f"Error processing variant {i+1}: {e}")
    
    # Create results DataFrame
    df = pd.DataFrame(results)
    df = df.sort_values('Abs_Effect', ascending=False)
    
    print("Variant scoring results:")
    print(df.to_string(index=False, float_format='%.6f'))
    
    # Identify high-impact variants
    high_impact = df[df['Abs_Effect'] > 0.1]
    print(f"\nHigh-impact variants (|effect| > 0.1): {len(high_impact)}")
    if len(high_impact) > 0:
        print(high_impact[['Variant_ID', 'Position', 'Effect_Size']].to_string(index=False))
  notes: This example demonstrates batch variant scoring for multiple SNPs within
    a genomic region. It calculates effect sizes for each variant and identifies high-impact
    variants that significantly alter gene expression predictions.
- query: Comprehensive multi-modal analysis
  code: |-
    import os
    from alphagenome.data import genome
    from alphagenome.models import dna_client
    from alphagenome.visualization import plot_components
    import matplotlib.pyplot as plt

    # Setup
    API_KEY = os.environ.get("ALPHAGENOME_API_KEY")
    model = dna_client.create(API_KEY)

    # Define genomic interval
    interval = genome.Interval(
        chromosome='chr22',
        start=35677410,
        end=36725986
    )

    # Request multiple output types
    output_types = [
        dna_client.OutputType.RNA_SEQ,
        dna_client.OutputType.SPLICING,
        dna_client.OutputType.CHROMATIN
    ]

    # Make comprehensive prediction
    outputs = model.predict(
        interval=interval,
        ontology_terms=['UBERON:0001157'],  # Liver tissue
        requested_outputs=output_types,
    )

    # Analyze each modality
    print("Multi-modal Analysis Results:")
    print("-" * 40)

    # RNA-seq analysis
    if hasattr(outputs, 'rna_seq'):
        rna_data = outputs.rna_seq
        print(f"RNA-seq Expression:")
        print(f"  Mean expression: {rna_data.values.mean():.4f}")
        print(f"  Max expression: {rna_data.values.max():.4f}")
        print(f"  Expression variance: {rna_data.values.var():.4f}")

    # Splicing analysis
    if hasattr(outputs, 'splicing'):
        splicing_data = outputs.splicing
        print(f"Splicing Predictions:")
        print(f"  Mean splicing score: {splicing_data.values.mean():.4f}")
        print(f"  Max splicing score: {splicing_data.values.max():.4f}")

    # Chromatin analysis
    if hasattr(outputs, 'chromatin'):
        chromatin_data = outputs.chromatin
        print(f"Chromatin Features:")
        print(f"  Mean accessibility: {chromatin_data.values.mean():.4f}")
        print(f"  Max accessibility: {chromatin_data.values.max():.4f}")

    # Create multi-track visualization
    tracks = []
    if hasattr(outputs, 'rna_seq'):
        tracks.append(plot_components.Track(
            tdata={'RNA-seq': outputs.rna_seq},
            colors={'RNA-seq': 'blue'}
        ))

    if hasattr(outputs, 'chromatin'):
        tracks.append(plot_components.Track(
            tdata={'Chromatin': outputs.chromatin},
            colors={'Chromatin': 'green'}
        ))

    if tracks:
        plot_components.plot(tracks, interval=interval)
        plt.title("Multi-modal Genomic Predictions")
        plt.tight_layout()
        plt.show()

    print(f"\nAnalysis complete for interval: {interval}")
  notes: This example demonstrates comprehensive multi-modal analysis using AlphaGenome.
    It requests multiple output types (RNA-seq, splicing, chromatin) and analyzes
    each modality to provide a complete picture of the genomic region's regulatory
    landscape.
- query: In silico mutagenesis analysis
  code: |-
    import os
    from alphagenome.data import genome
    from alphagenome.models import dna_client
    from alphagenome.interpretation import mutagenesis
    import numpy as np
    import pandas as pd
    
    # Setup
    API_KEY = os.environ.get("ALPHAGENOME_API_KEY")
    model = dna_client.create(API_KEY)
    
    # Define smaller interval for mutagenesis
    interval = genome.Interval(
        chromosome='chr22',
        start=36201680,
        end=36201720  # Small 40bp region
    )
    
    # Get baseline prediction
    baseline = model.predict(
        interval=interval,
        ontology_terms=['UBERON:0001157'],
        requested_outputs=[dna_client.OutputType.RNA_SEQ],
    )
    baseline_mean = baseline.rna_seq.values.mean()
    
    # Perform systematic mutagenesis
    bases = ['A', 'C', 'G', 'T']
    mutagenesis_results = []
    
    for pos in range(interval.start, interval.end):
        for alt_base in bases:
            # Create variant
            variant = genome.Variant(
                chromosome=interval.chromosome,
                position=pos,
                reference_bases='N',  # Placeholder
                alternate_bases=alt_base,
            )
            
            try:
                # Predict effect
                outputs = model.predict_variant(
                    interval=interval,
                    variant=variant,
                    ontology_terms=['UBERON:0001157'],
                    requested_outputs=[dna_client.OutputType.RNA_SEQ],
                )
                
                alt_mean = outputs.alternate.rna_seq.values.mean()
                effect = (alt_mean - baseline_mean) / baseline_mean
                
                mutagenesis_results.append({
                    'Position': pos,
                    'Alt_Base': alt_base,
                    'Effect_Size': effect,
                    'Abs_Effect': abs(effect)
                })
                
            except Exception as e:
                print(f"Error at position {pos} with {alt_base}: {e}")
    
    # Analyze results
    if mutagenesis_results:
        df = pd.DataFrame(mutagenesis_results)
        
        # Find most sensitive positions
        position_effects = df.groupby('Position')['Abs_Effect'].max().sort_values(ascending=False)
        
        print("In Silico Mutagenesis Results:")
        print("-" * 35)
        print(f"Total mutations tested: {len(df)}")
        print(f"Mean absolute effect: {df['Abs_Effect'].mean():.6f}")
        print(f"Max absolute effect: {df['Abs_Effect'].max():.6f}")
        
        print("\nTop 5 most sensitive positions:")
        for pos, effect in position_effects.head().items():
            print(f"  Position {pos}: max effect = {effect:.6f}")
        
        # Find most impactful mutations
        top_mutations = df.nlargest(5, 'Abs_Effect')
        print("\nTop 5 most impactful mutations:")
        for _, row in top_mutations.iterrows():
            print(f"  {row['Position']}{row['Alt_Base']}: effect = {row['Effect_Size']:.6f}")
    
    else:
        print("No mutagenesis results obtained.")
  notes: This example demonstrates in silico mutagenesis analysis to identify functionally
    important positions within a genomic region. It systematically tests all possible
    single nucleotide changes and identifies positions that are most sensitive to
    mutation, helping to understand sequence-function relationships.
- query: Multi-track genomic visualization with transcript annotations
  code: |-
    import os
    from alphagenome.data import genome
    from alphagenome.models import dna_client
    from alphagenome.visualization import plot_components
    import matplotlib.pyplot as plt
    import pandas as pd
    
    # Setup
    API_KEY = os.environ.get("ALPHAGENOME_API_KEY")
    model = dna_client.create(API_KEY)
    
    # Define genomic interval
    interval = genome.Interval(
        chromosome='chr22',
        start=35677410,
        end=36725986
    )
    
    # Load transcript annotations (example data structure)
    longest_transcripts = pd.DataFrame({
        'gene_id': ['ENSG00000100055'],
        'transcript_id': ['ENST00000216714'],
        'chromosome': ['chr22'],
        'start': [35677410],
        'end': [36725986],
        'strand': ['+']
    })
    
    # Get comprehensive predictions
    output = model.predict(
        interval=interval,
        ontology_terms=['UBERON:0001157'],  # Liver tissue
        requested_outputs=[
            dna_client.OutputType.RNA_SEQ,
            dna_client.OutputType.CAGE,
            dna_client.OutputType.ATAC,
        ],
    )
    
    # Create multi-track visualization
    plot_components.plot([
        # Transcript annotations
        plot_components.TranscriptAnnotation(longest_transcripts),
        
        # RNA-seq expression track
        plot_components.Tracks(
            tdata=output.rna_seq,
            ylabel_template='RNA_SEQ: {biosample_name}'
        ),
        
        # CAGE transcription start sites
        plot_components.Tracks(
            tdata=output.cage,
            ylabel_template='CAGE: {biosample_name}'
        ),
        
        # ATAC-seq accessibility
        plot_components.Tracks(
            tdata=output.atac,
            ylabel_template='ATAC: {biosample_name}'
        ),
    ], interval=interval)
    
    plt.title("Multi-Modal Genomic Predictions")
    plt.tight_layout()
    plt.show()
    
    print(f"Visualization created for interval: {interval}")
    print(f"Number of tracks displayed: 4 (transcripts + 3 data tracks)")
  notes: This example demonstrates comprehensive multi-track genomic visualization
    combining transcript annotations with multiple prediction modalities. It shows
    how to create publication-quality figures that integrate gene structure with functional
    predictions from RNA-seq, CAGE, and ATAC-seq data.
- query: Tissue ontology navigation and filtering
  code: |-
    import os
    from alphagenome.models import dna_client
    import pandas as pd

    # Setup
    API_KEY = os.environ.get("ALPHAGENOME_API_KEY")
    model = dna_client.create(API_KEY)

    # Get comprehensive ontology metadata
    metadata = model.get_output_metadata('homo_sapiens')
    df_metadata = pd.DataFrame(metadata)

    print(f"Total ontology entries: {len(df_metadata)}")
    print(f"Ontology systems covered: {df_metadata['ontology_system'].unique()}")

    # Filter by tissue types
    brain_entries = df_metadata[df_metadata['tissue_name'].str.contains('brain', case=False, na=False)]
    liver_entries = df_metadata[df_metadata['tissue_name'].str.contains('liver', case=False, na=False)]
    blood_entries = df_metadata[df_metadata['tissue_name'].str.contains('blood|hematopoietic', case=False, na=False)]

    print(f"\nTissue-specific entries:")
    print(f"  Brain-related: {len(brain_entries)}")
    print(f"  Liver-related: {len(liver_entries)}")
    print(f"  Blood/hematopoietic: {len(blood_entries)}")

    # Explore cell line vs primary tissue breakdown
    cell_lines = df_metadata[df_metadata['sample_type'] == 'cell_line']
    primary_tissues = df_metadata[df_metadata['sample_type'] == 'primary_tissue']

    print(f"\nSample type breakdown:")
    print(f"  Cell lines: {len(cell_lines)}")
    print(f"  Primary tissues: {len(primary_tissues)}")

    # Get ontology terms for specific use cases
    stem_cell_terms = df_metadata[df_metadata['tissue_name'].str.contains('stem cell', case=False, na=False)]
    cancer_terms = df_metadata[df_metadata['tissue_name'].str.contains('cancer|tumor', case=False, na=False)]

    print(f"\nSpecialized contexts:")
    print(f"  Stem cell contexts: {len(stem_cell_terms)}")
    print(f"  Cancer contexts: {len(cancer_terms)}")

    # Display sample ontology terms
    print(f"\nExample stem cell ontology terms:")
    for i, row in stem_cell_terms.head(3).iterrows():
        print(f"  {row['ontology_id']}: {row['tissue_name']}")

    # Filter by developmental stage
    embryonic = df_metadata[df_metadata['life_stage'].str.contains('embryonic', case=False, na=False)]
    adult = df_metadata[df_metadata['life_stage'].str.contains('adult', case=False, na=False)]

    print(f"\nDevelopmental stage breakdown:")
    print(f"  Embryonic: {len(embryonic)}")
    print(f"  Adult: {len(adult)}")
  notes: This example demonstrates comprehensive navigation of AlphaGenome's tissue
    ontology system with 5,563 entries. It shows how to filter by tissue types, sample
    types, developmental stages, and specialized contexts like stem cells and cancer.
    The ontology system supports UBERON, CL, and EFO standards for precise tissue-specific
    genomic analysis.
- query: Batch VCF variant scoring with progress tracking
  code: |-
    import os
    import pandas as pd
    from tqdm import tqdm
    from alphagenome.data import genome
    from alphagenome.models import dna_client
    
    # Setup
    API_KEY = os.environ.get("ALPHAGENOME_API_KEY")
    model = dna_client.create(API_KEY)
    
    # Create example VCF data
    vcf_data = {
        'variant_id': ['rs1234567', 'rs2345678', 'rs3456789', 'rs4567890'],
        'CHROM': ['chr1', 'chr2', 'chr3', 'chr4'],
        'POS': [1000000, 2000000, 3000000, 4000000],
        'REF': ['A', 'G', 'C', 'T'],
        'ALT': ['G', 'T', 'A', 'C']
    }
    vcf = pd.DataFrame(vcf_data)
    
    # Define analysis parameters
    sequence_length = 50000  # 50kb context window
    tissue_ontology = 'UBERON:0001157'  # Liver tissue
    
    # Configure multi-modal scoring
    scoring_types = [
        dna_client.OutputType.RNA_SEQ,
        dna_client.OutputType.CAGE,
        dna_client.OutputType.ATAC,
        dna_client.OutputType.DNASE,
    ]
    
    # Process variants with progress tracking
    results = []
    failed_variants = []
    
    for i, vcf_row in tqdm(vcf.iterrows(), total=len(vcf), desc="Processing variants"):
        variant = genome.Variant(
            chromosome=str(vcf_row.CHROM),
            position=int(vcf_row.POS),
            reference_bases=vcf_row.REF,
            alternate_bases=vcf_row.ALT,
            name=vcf_row.variant_id,
        )
        
        # Define interval around variant
        interval = genome.Interval(
            chromosome=variant.chromosome,
            start=max(1, variant.position - sequence_length//2),
            end=variant.position + sequence_length//2
        )
        
        try:
            # Score variant across multiple modalities
            output = model.predict_variant(
                interval=interval,
                variant=variant,
                ontology_terms=[tissue_ontology],
                requested_outputs=scoring_types,
            )
            
            # Calculate effect sizes for each modality
            rna_ref = output.reference.rna_seq.values.mean()
            rna_alt = output.alternate.rna_seq.values.mean()
            rna_effect = (rna_alt - rna_ref) / rna_ref if rna_ref != 0 else 0
            
            cage_ref = output.reference.cage.values.mean()
            cage_alt = output.alternate.cage.values.mean()
            cage_effect = (cage_alt - cage_ref) / cage_ref if cage_ref != 0 else 0
            
            atac_ref = output.reference.atac.values.mean()
            atac_alt = output.alternate.atac.values.mean()
            atac_effect = (atac_alt - atac_ref) / atac_ref if atac_ref != 0 else 0
            
            # Compile results
            result = {
                'variant_id': variant.name,
                'chromosome': variant.chromosome,
                'position': variant.position,
                'ref_allele': variant.reference_bases,
                'alt_allele': variant.alternate_bases,
                'rna_seq_effect': rna_effect,
                'cage_effect': cage_effect,
                'atac_effect': atac_effect,
                'max_abs_effect': max(abs(rna_effect), abs(cage_effect), abs(atac_effect)),
                'high_impact': max(abs(rna_effect), abs(cage_effect), abs(atac_effect)) > 0.1
            }
            results.append(result)
            
        except Exception as e:
            failed_variants.append({
                'variant_id': variant.name,
                'error': str(e)
            })
            continue
    
    # Process results
    if results:
        results_df = pd.DataFrame(results)
        results_df = results_df.sort_values('max_abs_effect', ascending=False)
        
        print(f"\nBatch variant scoring completed:")
        print(f"  Successfully processed: {len(results_df)} variants")
        print(f"  Failed: {len(failed_variants)} variants")
        print(f"  High-impact variants: {results_df['high_impact'].sum()}")
        
        # Display top variants
        print(f"\nTop 3 variants by maximum effect:")
        top_variants = results_df.head(3)
        for _, row in top_variants.iterrows():
            print(f"  {row['variant_id']}: max effect = {row['max_abs_effect']:.4f}")
        
        # Export results
        results_df.to_csv('variant_scoring_results.csv', index=False)
        print(f"\nResults exported to 'variant_scoring_results.csv'")
        
    else:
        print("No variants successfully processed.")
  notes: This example demonstrates efficient batch processing of VCF variants with
    comprehensive multi-modal scoring. It includes progress tracking with tqdm, error
    handling, effect size calculations, and result export. The workflow is optimized
    for processing hundreds to thousands of variants across multiple genomic data
    modalities.
- query: TAL1 oncogenic variant analysis workflow
  code: |-
    import os
    import pandas as pd
    from alphagenome.data import genome
    from alphagenome.models import dna_client
    from alphagenome.visualization import plot_components
    import matplotlib.pyplot as plt
    
    # Setup
    API_KEY = os.environ.get("ALPHAGENOME_API_KEY")
    model = dna_client.create(API_KEY)
    
    # TAL1 locus definition (T-cell acute lymphocytic leukemia 1)
    tal1_interval = genome.Interval(
        chromosome='chr1',
        start=47200000,
        end=47300000  # 100kb region around TAL1
    )
    
    # Known oncogenic variants in TAL1 regulatory region
    oncogenic_variants = [
        genome.Variant(
            chromosome='chr1',
            position=47240000,
            reference_bases='G',
            alternate_bases='A',
            name='TAL1_regulatory_variant_1'
        ),
        genome.Variant(
            chromosome='chr1',
            position=47245000,
            reference_bases='C',
            alternate_bases='T',
            name='TAL1_regulatory_variant_2'
        ),
        genome.Variant(
            chromosome='chr1',
            position=47250000,
            reference_bases='A',
            alternate_bases='G',
            name='TAL1_regulatory_variant_3'
        ),
    ]
    
    # Analyze in hematopoietic context (CD34+ stem cells)
    cd34_ontology = 'CL:0000037'  # CD34+ stem cell
    
    # Define analysis modalities
    analysis_outputs = [
        dna_client.OutputType.RNA_SEQ,
        dna_client.OutputType.ATAC,
        dna_client.OutputType.HISTONE_MARKS,
        dna_client.OutputType.TF_BINDING
    ]
    
    # Analyze each variant
    variant_results = {}
    
    for variant in oncogenic_variants:
        print(f"Analyzing variant: {variant.name}")
        
        # Predict variant effects
        output = model.predict_variant(
            interval=tal1_interval,
            variant=variant,
            ontology_terms=[cd34_ontology],
            requested_outputs=analysis_outputs,
        )
        
        # Calculate effect sizes
        rna_ref = output.reference.rna_seq.values.mean()
        rna_alt = output.alternate.rna_seq.values.mean()
        rna_effect = (rna_alt - rna_ref) / rna_ref if rna_ref != 0 else 0
        
        atac_ref = output.reference.atac.values.mean()
        atac_alt = output.alternate.atac.values.mean()
        atac_effect = (atac_alt - atac_ref) / atac_ref if atac_ref != 0 else 0
        
        # Calculate TAL1 upregulation potential
        tal1_upregulation_score = max(rna_effect, 0)  # Only positive effects
        chromatin_disruption_score = abs(atac_effect)
        
        # Oncogenic potential assessment
        oncogenic_score = (tal1_upregulation_score * 0.7 + chromatin_disruption_score * 0.3)
        is_high_risk = oncogenic_score > 0.15
        
        variant_results[variant.name] = {
            'position': variant.position,
            'ref_alt': f"{variant.reference_bases}>{variant.alternate_bases}",
            'rna_expression_effect': rna_effect,
            'chromatin_accessibility_effect': atac_effect,
            'tal1_upregulation_score': tal1_upregulation_score,
            'chromatin_disruption_score': chromatin_disruption_score,
            'oncogenic_score': oncogenic_score,
            'high_risk_classification': is_high_risk,
            'output_data': output
        }
        
        print(f"  RNA effect: {rna_effect:.4f}")
        print(f"  ATAC effect: {atac_effect:.4f}")
        print(f"  Oncogenic score: {oncogenic_score:.4f}")
        print(f"  High risk: {is_high_risk}")
    
    # Summary analysis
    print(f"\nTAL1 Oncogenic Variant Analysis Summary:")
    print(f"=" * 45)
    
    high_risk_variants = [v for v, r in variant_results.items() if r['high_risk_classification']]
    print(f"High-risk variants identified: {len(high_risk_variants)}")
    
    # Create visualization for high-risk variants
    for variant_name in high_risk_variants:
        result = variant_results[variant_name]
        output = result['output_data']
        
        # Create multi-track visualization
        fig, axes = plt.subplots(2, 1, figsize=(12, 8))
        
        # RNA expression comparison
        plt.subplot(2, 1, 1)
        plot_components.plot([
            plot_components.OverlaidTracks(
                tdata={
                    'Reference': output.reference.rna_seq,
                    'Alternate': output.alternate.rna_seq,
                },
                colors={'Reference': 'blue', 'Alternate': 'red'},
            ),
        ], interval=tal1_interval)
        plt.title(f"RNA Expression: {variant_name}")
        
        # Chromatin accessibility comparison
        plt.subplot(2, 1, 2)
        plot_components.plot([
            plot_components.OverlaidTracks(
                tdata={
                    'Reference': output.reference.atac,
                    'Alternate': output.alternate.atac,
                },
                colors={'Reference': 'green', 'Alternate': 'orange'},
            ),
        ], interval=tal1_interval)
        plt.title(f"Chromatin Accessibility: {variant_name}")
        
        plt.tight_layout()
        plt.show()
        
        print(f"\nVisualization created for {variant_name}")
    
    # Clinical interpretation
    print(f"\nClinical Interpretation:")
    print(f"- {len(high_risk_variants)} variants show high oncogenic potential")
    print(f"- These variants likely contribute to TAL1 upregulation")
    print(f"- Mechanism involves disruption of regulatory chromatin structure")
    print(f"- May serve as therapeutic targets for precision medicine")
    
    # Export results
    results_df = pd.DataFrame.from_dict(variant_results, orient='index')
    results_df.to_csv('tal1_oncogenic_analysis.csv')
    print(f"\nDetailed results exported to 'tal1_oncogenic_analysis.csv'")
  notes: This example demonstrates comprehensive oncogenic variant analysis focused
    on the TAL1 locus, a critical gene in T-cell acute lymphocytic leukemia. The workflow
    analyzes regulatory variants in hematopoietic stem cell context, calculates oncogenic
    potential scores, and provides clinical interpretation. It represents a complete
    research workflow from variant identification to mechanistic understanding and
    clinical relevance.
- query: Predict functional effects of cancer mutations on gene expression and chromatin accessibility in tissue-specific context
  code: |-
    import os
    from alphagenome.data import genome
    from alphagenome.models import dna_client
    from alphagenome.visualization import plot_components
    import matplotlib.pyplot as plt
    
    # 1. Set up AlphaGenome model with API authentication
    API_KEY = os.environ.get("ALPHAGENOME_API_KEY")
    model = dna_client.create(API_KEY)
    
    # 2. Define cancer mutation for analysis (EGFR L858R)
    mutation_pos = 55191822
    interval = genome.Interval(
        chromosome='chr7',
        start=mutation_pos - 1024,  # Use supported 2048bp window
        end=mutation_pos + 1024
    )
    
    variant = genome.Variant(
        chromosome='chr7',
        position=mutation_pos,
        reference_bases='T',
        alternate_bases='C',
        name='EGFR_L858R'
    )
    
    # 3. Predict variant effects in lung tissue context
    outputs = model.predict_variant(
        interval=interval,
        variant=variant,
        ontology_terms=['UBERON:0002048'],  # Lung tissue
        requested_outputs=[
            dna_client.OutputType.RNA_SEQ,
            dna_client.OutputType.ATAC,
            dna_client.OutputType.DNASE,
            dna_client.OutputType.SPLICE_JUNCTIONS
        ],
    )
    
    # 4. Calculate quantitative effect sizes
    def calc_effect(ref, alt, modality_name):
        ref_mean = ref.values.mean()
        alt_mean = alt.values.mean()
        ref_max = ref.values.max()
        alt_max = alt.values.max()
        
        mean_effect = (alt_mean - ref_mean) / ref_mean if ref_mean != 0 else 0
        max_effect = (alt_max - ref_max) / ref_max if ref_max != 0 else 0
        
        print(f"{modality_name}:")
        print(f"  Mean effect: {mean_effect:.4f} ({mean_effect*100:.2f}%)")
        print(f"  Max effect: {max_effect:.4f} ({max_effect*100:.2f}%)")
        
        return mean_effect, max_effect
    
    # Analyze each modality
    effects = {}
    if hasattr(outputs.reference, 'rna_seq') and hasattr(outputs.alternate, 'rna_seq'):
        effects['RNA_Expression'] = calc_effect(outputs.reference.rna_seq, outputs.alternate.rna_seq, "RNA Expression")
    
    if hasattr(outputs.reference, 'atac') and hasattr(outputs.alternate, 'atac'):
        effects['Chromatin_Access'] = calc_effect(outputs.reference.atac, outputs.alternate.atac, "Chromatin Accessibility")
    
    if hasattr(outputs.reference, 'dnase') and hasattr(outputs.alternate, 'dnase'):
        effects['DNase'] = calc_effect(outputs.reference.dnase, outputs.alternate.dnase, "DNase Hypersensitivity")
    
    if hasattr(outputs.reference, 'splice_junctions') and hasattr(outputs.alternate, 'splice_junctions'):
        effects['Splicing'] = calc_effect(outputs.reference.splice_junctions, outputs.alternate.splice_junctions, "Splice Junctions")
    
    # 5. Create visualization
    tracks = []
    if hasattr(outputs.reference, 'rna_seq'):
        tracks.append(
            plot_components.OverlaidTracks(
                tdata={
                    'Reference RNA-seq': outputs.reference.rna_seq,
                    'Alternate RNA-seq': outputs.alternate.rna_seq,
                },
                colors={'Reference RNA-seq': 'blue', 'Alternate RNA-seq': 'red'},
            )
        )
    
    if hasattr(outputs.reference, 'atac'):
        tracks.append(
            plot_components.OverlaidTracks(
                tdata={
                    'Reference ATAC': outputs.reference.atac,
                    'Alternate ATAC': outputs.alternate.atac,
                },
                colors={'Reference ATAC': 'green', 'Alternate ATAC': 'orange'},
            )
        )
    
    if tracks:
        plot_components.plot(
            tracks,
            interval=interval,
            annotations=[plot_components.VariantAnnotation([variant], alpha=0.8)],
        )
        plt.title(f"EGFR L858R Functional Impact in Lung Tissue")
        plt.tight_layout()
        plt.show()
    
    print(f"\nAnalysis complete for {variant.name} in lung tissue context")
    print("Functional predictions can be compared with clinical expression data")
  notes: 'This example demonstrates comprehensive variant effect prediction for cancer
    mutations using AlphaGenome. Key features: 1) Uses proper 2048bp genomic intervals
    (supported sequence length), 2) Analyzes multiple functional modalities (RNA-seq,
    ATAC-seq, DNase-seq, splicing), 3) Applies tissue-specific context (lung tissue
    for lung cancer), 4) Calculates quantitative effect sizes for comparison with
    clinical data, 5) Creates multi-track visualizations, 6) Handles API authentication
    properly. This workflow is ideal for validating clinical genomics findings with
    functional predictions and understanding the mechanistic basis of cancer mutations.'
